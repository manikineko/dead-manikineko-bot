import { AI } from "../../../../.robo/build/core/ai.js";
import { logger } from "../../../../.robo/build/core/logger.js";
import { options as pluginOptions } from "../../../../.robo/build/events/_start.js";
export default ((req)=>{
    return new Promise((resolve, reject)=>{
        const run = async ()=>{
            const { messages  } = req.body;
            if (!messages?.length) {
                return reject('No message provided');
            }
            // Only insert system message if none already provided & exists
            const gptMessages = messages;
            const systemMessage = gptMessages.find((message)=>message.role === 'system');
            if (!systemMessage && pluginOptions.systemMessage) {
                gptMessages.unshift({
                    content: pluginOptions.systemMessage,
                    role: 'system'
                });
            }
            AI.chat(gptMessages, {
                onReply: (message)=>{
                    logger.debug('API Chat response:', message);
                    resolve({
                        message: message.text ?? ''
                    });
                }
            });
        };
        run();
    });
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL3J1bm5lci93b3JrL3JvYm8uanMvcm9iby5qcy9wYWNrYWdlcy9wbHVnaW4tYWkvc3JjL2FwaS9haS9jaGF0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFJIH0gZnJvbSAnQC9jb3JlL2FpLmpzJ1xuaW1wb3J0IHsgbG9nZ2VyIH0gZnJvbSAnQC9jb3JlL2xvZ2dlci5qcydcbmltcG9ydCB7IG9wdGlvbnMgYXMgcGx1Z2luT3B0aW9ucyB9IGZyb20gJ0AvZXZlbnRzL19zdGFydC5qcydcbmltcG9ydCB0eXBlIHsgQ2hhdE1lc3NhZ2UgfSBmcm9tICdAL2VuZ2luZXMvYmFzZS5qcydcbmltcG9ydCB0eXBlIHsgUm9ib1JlcXVlc3QgfSBmcm9tICdAcm9ib2pzL3NlcnZlcidcblxuaW50ZXJmYWNlIEFwaUNoYXRSZXF1ZXN0IHtcblx0ZnVuY3Rpb25DYWxsPzogc3RyaW5nXG5cdG1lc3NhZ2VzOiBDaGF0TWVzc2FnZVtdXG5cdG1vZGVsPzogc3RyaW5nXG59XG5cbmludGVyZmFjZSBBcGlDaGF0UmVzcG9uc2Uge1xuXHRtZXNzYWdlOiBzdHJpbmdcbn1cblxuZXhwb3J0IGRlZmF1bHQgKHJlcTogUm9ib1JlcXVlc3Q8QXBpQ2hhdFJlcXVlc3Q+KTogUHJvbWlzZTxBcGlDaGF0UmVzcG9uc2U+ID0+IHtcblx0cmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcblx0XHRjb25zdCBydW4gPSBhc3luYyAoKSA9PiB7XG5cdFx0XHRjb25zdCB7IG1lc3NhZ2VzIH0gPSByZXEuYm9keVxuXHRcdFx0aWYgKCFtZXNzYWdlcz8ubGVuZ3RoKSB7XG5cdFx0XHRcdHJldHVybiByZWplY3QoJ05vIG1lc3NhZ2UgcHJvdmlkZWQnKVxuXHRcdFx0fVxuXG5cdFx0XHQvLyBPbmx5IGluc2VydCBzeXN0ZW0gbWVzc2FnZSBpZiBub25lIGFscmVhZHkgcHJvdmlkZWQgJiBleGlzdHNcblx0XHRcdGNvbnN0IGdwdE1lc3NhZ2VzID0gbWVzc2FnZXNcblx0XHRcdGNvbnN0IHN5c3RlbU1lc3NhZ2UgPSBncHRNZXNzYWdlcy5maW5kKChtZXNzYWdlKSA9PiBtZXNzYWdlLnJvbGUgPT09ICdzeXN0ZW0nKVxuXG5cdFx0XHRpZiAoIXN5c3RlbU1lc3NhZ2UgJiYgcGx1Z2luT3B0aW9ucy5zeXN0ZW1NZXNzYWdlKSB7XG5cdFx0XHRcdGdwdE1lc3NhZ2VzLnVuc2hpZnQoe1xuXHRcdFx0XHRcdGNvbnRlbnQ6IHBsdWdpbk9wdGlvbnMuc3lzdGVtTWVzc2FnZSxcblx0XHRcdFx0XHRyb2xlOiAnc3lzdGVtJ1xuXHRcdFx0XHR9KVxuXHRcdFx0fVxuXG5cdFx0XHRBSS5jaGF0KGdwdE1lc3NhZ2VzLCB7XG5cdFx0XHRcdG9uUmVwbHk6IChtZXNzYWdlKSA9PiB7XG5cdFx0XHRcdFx0bG9nZ2VyLmRlYnVnKCdBUEkgQ2hhdCByZXNwb25zZTonLCBtZXNzYWdlKVxuXHRcdFx0XHRcdHJlc29sdmUoe1xuXHRcdFx0XHRcdFx0bWVzc2FnZTogbWVzc2FnZS50ZXh0ID8/ICcnXG5cdFx0XHRcdFx0fSlcblx0XHRcdFx0fVxuXHRcdFx0fSlcblx0XHR9XG5cdFx0cnVuKClcblx0fSlcbn1cbiJdLCJuYW1lcyI6WyJBSSIsImxvZ2dlciIsIm9wdGlvbnMiLCJwbHVnaW5PcHRpb25zIiwicmVxIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJydW4iLCJtZXNzYWdlcyIsImJvZHkiLCJsZW5ndGgiLCJncHRNZXNzYWdlcyIsInN5c3RlbU1lc3NhZ2UiLCJmaW5kIiwibWVzc2FnZSIsInJvbGUiLCJ1bnNoaWZ0IiwiY29udGVudCIsImNoYXQiLCJvblJlcGx5IiwiZGVidWciLCJ0ZXh0Il0sIm1hcHBpbmdzIjoiQUFBQSxTQUFTQSxFQUFFLFFBQVEscUNBQWM7QUFDakMsU0FBU0MsTUFBTSxRQUFRLHlDQUFrQjtBQUN6QyxTQUFTQyxXQUFXQyxhQUFhLFFBQVEsMkNBQW9CO0FBYzdELGVBQWUsQ0FBQSxDQUFDQyxNQUErRDtJQUM5RSxPQUFPLElBQUlDLFFBQVEsQ0FBQ0MsU0FBU0MsU0FBVztRQUN2QyxNQUFNQyxNQUFNLFVBQVk7WUFDdkIsTUFBTSxFQUFFQyxTQUFRLEVBQUUsR0FBR0wsSUFBSU0sSUFBSTtZQUM3QixJQUFJLENBQUNELFVBQVVFLFFBQVE7Z0JBQ3RCLE9BQU9KLE9BQU87WUFDZixDQUFDO1lBRUQsK0RBQStEO1lBQy9ELE1BQU1LLGNBQWNIO1lBQ3BCLE1BQU1JLGdCQUFnQkQsWUFBWUUsSUFBSSxDQUFDLENBQUNDLFVBQVlBLFFBQVFDLElBQUksS0FBSztZQUVyRSxJQUFJLENBQUNILGlCQUFpQlYsY0FBY1UsYUFBYSxFQUFFO2dCQUNsREQsWUFBWUssT0FBTyxDQUFDO29CQUNuQkMsU0FBU2YsY0FBY1UsYUFBYTtvQkFDcENHLE1BQU07Z0JBQ1A7WUFDRCxDQUFDO1lBRURoQixHQUFHbUIsSUFBSSxDQUFDUCxhQUFhO2dCQUNwQlEsU0FBUyxDQUFDTCxVQUFZO29CQUNyQmQsT0FBT29CLEtBQUssQ0FBQyxzQkFBc0JOO29CQUNuQ1QsUUFBUTt3QkFDUFMsU0FBU0EsUUFBUU8sSUFBSSxJQUFJO29CQUMxQjtnQkFDRDtZQUNEO1FBQ0Q7UUFDQWQ7SUFDRDtBQUNELENBQUEsRUFBQyJ9