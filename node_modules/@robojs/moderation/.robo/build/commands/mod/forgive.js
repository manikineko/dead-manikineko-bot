import { hasPermission, logAction } from '../../core/utils.js';
import { getSettings } from '../../core/settings.js';
import { Flashcore, color, logger } from 'robo.js';
import { Colors, PermissionFlagsBits } from 'discord.js';
export const config = {
    defaultMemberPermissions: PermissionFlagsBits.ModerateMembers,
    description: `Forgive a member and clear their strikes`,
    dmPermission: false,
    options: [
        {
            name: 'member',
            description: 'The @member to forgive',
            type: 'user',
            required: true
        },
        {
            name: 'reason',
            description: 'The reason for forgiving the member'
        },
        {
            name: 'anonymous',
            description: 'Whether to send the warning anonymously',
            type: 'boolean'
        }
    ]
};
export default (async (interaction)=>{
    const anonymous = (interaction.options.get('anonymous')?.value) ?? false;
    const member = interaction.options.get('member')?.member;
    const reason = interaction.options.get('reason')?.value;
    // Validate permissions
    if (!hasPermission(interaction, 'ModerateMembers')) {
        logger.debug(`User @${interaction.user.username} does not have permission to run ${color.bold('/mod warn')}`);
        return {
            content: `You don't have permission to use this.`,
            ephemeral: true
        };
    }
    // Prepare message payload
    const messagePayload = {
        content: member.toString(),
        embeds: [
            {
                title: `You have been forgiven`,
                thumbnail: {
                    url: member.displayAvatarURL()
                },
                description: reason ?? '',
                color: Colors.Green,
                footer: {
                    text: 'âœ… You now have 0 infractions.'
                }
            }
        ]
    };
    // Log action to modlogs channel if this is not it
    const { logsChannelId , testMode  } = getSettings(interaction.guildId);
    if (interaction.channelId !== logsChannelId) {
        const testPrefix = testMode ? '[TEST] ' : '';
        logAction(interaction.guildId, {
            embeds: [
                {
                    title: testPrefix + `Member forgiven`,
                    thumbnail: {
                        url: member.displayAvatarURL()
                    },
                    description: `${member} has been forgiven`,
                    color: Colors.Green,
                    timestamp: new Date().toISOString(),
                    footer: {
                        icon_url: interaction.user.displayAvatarURL(),
                        text: 'by @' + interaction.user.username
                    }
                }
            ]
        });
    }
    // Test mode - don't actually forgive
    if (testMode) {
        return {
            embeds: [
                {
                    title: 'Test mode',
                    description: 'This is a test. No action has been taken.',
                    color: Colors.Yellow,
                    footer: {
                        text: (logsChannelId ? 'See' : 'Setup') + ` modlogs channel for details`
                    }
                }
            ],
            ephemeral: true
        };
    }
    // Update infractions
    await Flashcore.set('infractions', 0, {
        namespace: interaction.guildId + member.id
    });
    if (anonymous) {
        await interaction.channel?.send(messagePayload);
        return {
            content: 'Strikes have been cleared for ' + member.user.username,
            ephemeral: true
        };
    }
    return messagePayload;
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL3J1bm5lci93b3JrL3JvYm8uanMvcm9iby5qcy9wYWNrYWdlcy9wbHVnaW4tbW9kdG9vbHMvc3JjL2NvbW1hbmRzL21vZC9mb3JnaXZlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGhhc1Blcm1pc3Npb24sIGxvZ0FjdGlvbiB9IGZyb20gJy4uLy4uL2NvcmUvdXRpbHMuanMnXG5pbXBvcnQgeyBnZXRTZXR0aW5ncyB9IGZyb20gJy4uLy4uL2NvcmUvc2V0dGluZ3MuanMnXG5pbXBvcnQgeyBGbGFzaGNvcmUsIGNvbG9yLCBsb2dnZXIgfSBmcm9tICdyb2JvLmpzJ1xuaW1wb3J0IHsgQ29sb3JzLCBQZXJtaXNzaW9uRmxhZ3NCaXRzIH0gZnJvbSAnZGlzY29yZC5qcydcbmltcG9ydCB0eXBlIHsgQ29tbWFuZENvbmZpZywgQ29tbWFuZFJlc3VsdCB9IGZyb20gJ3JvYm8uanMnXG5pbXBvcnQgdHlwZSB7IENvbW1hbmRJbnRlcmFjdGlvbiwgR3VpbGRNZW1iZXIsIE1lc3NhZ2VDcmVhdGVPcHRpb25zIH0gZnJvbSAnZGlzY29yZC5qcydcblxuZXhwb3J0IGNvbnN0IGNvbmZpZzogQ29tbWFuZENvbmZpZyA9IHtcblx0ZGVmYXVsdE1lbWJlclBlcm1pc3Npb25zOiBQZXJtaXNzaW9uRmxhZ3NCaXRzLk1vZGVyYXRlTWVtYmVycyxcblx0ZGVzY3JpcHRpb246IGBGb3JnaXZlIGEgbWVtYmVyIGFuZCBjbGVhciB0aGVpciBzdHJpa2VzYCxcblx0ZG1QZXJtaXNzaW9uOiBmYWxzZSxcblx0b3B0aW9uczogW1xuXHRcdHtcblx0XHRcdG5hbWU6ICdtZW1iZXInLFxuXHRcdFx0ZGVzY3JpcHRpb246ICdUaGUgQG1lbWJlciB0byBmb3JnaXZlJyxcblx0XHRcdHR5cGU6ICd1c2VyJyxcblx0XHRcdHJlcXVpcmVkOiB0cnVlXG5cdFx0fSxcblx0XHR7XG5cdFx0XHRuYW1lOiAncmVhc29uJyxcblx0XHRcdGRlc2NyaXB0aW9uOiAnVGhlIHJlYXNvbiBmb3IgZm9yZ2l2aW5nIHRoZSBtZW1iZXInXG5cdFx0fSxcblx0XHR7XG5cdFx0XHRuYW1lOiAnYW5vbnltb3VzJyxcblx0XHRcdGRlc2NyaXB0aW9uOiAnV2hldGhlciB0byBzZW5kIHRoZSB3YXJuaW5nIGFub255bW91c2x5Jyxcblx0XHRcdHR5cGU6ICdib29sZWFuJ1xuXHRcdH1cblx0XVxufVxuXG5leHBvcnQgZGVmYXVsdCBhc3luYyAoaW50ZXJhY3Rpb246IENvbW1hbmRJbnRlcmFjdGlvbik6IFByb21pc2U8Q29tbWFuZFJlc3VsdD4gPT4ge1xuXHRjb25zdCBhbm9ueW1vdXMgPSAoaW50ZXJhY3Rpb24ub3B0aW9ucy5nZXQoJ2Fub255bW91cycpPy52YWx1ZSBhcyBib29sZWFuKSA/PyBmYWxzZVxuXHRjb25zdCBtZW1iZXIgPSBpbnRlcmFjdGlvbi5vcHRpb25zLmdldCgnbWVtYmVyJyk/Lm1lbWJlciBhcyBHdWlsZE1lbWJlclxuXHRjb25zdCByZWFzb24gPSBpbnRlcmFjdGlvbi5vcHRpb25zLmdldCgncmVhc29uJyk/LnZhbHVlIGFzIHN0cmluZ1xuXG5cdC8vIFZhbGlkYXRlIHBlcm1pc3Npb25zXG5cdGlmICghaGFzUGVybWlzc2lvbihpbnRlcmFjdGlvbiwgJ01vZGVyYXRlTWVtYmVycycpKSB7XG5cdFx0bG9nZ2VyLmRlYnVnKGBVc2VyIEAke2ludGVyYWN0aW9uLnVzZXIudXNlcm5hbWV9IGRvZXMgbm90IGhhdmUgcGVybWlzc2lvbiB0byBydW4gJHtjb2xvci5ib2xkKCcvbW9kIHdhcm4nKX1gKVxuXHRcdHJldHVybiB7XG5cdFx0XHRjb250ZW50OiBgWW91IGRvbid0IGhhdmUgcGVybWlzc2lvbiB0byB1c2UgdGhpcy5gLFxuXHRcdFx0ZXBoZW1lcmFsOiB0cnVlXG5cdFx0fVxuXHR9XG5cblx0Ly8gUHJlcGFyZSBtZXNzYWdlIHBheWxvYWRcblx0Y29uc3QgbWVzc2FnZVBheWxvYWQ6IENvbW1hbmRSZXN1bHQgPSB7XG5cdFx0Y29udGVudDogbWVtYmVyLnRvU3RyaW5nKCksXG5cdFx0ZW1iZWRzOiBbXG5cdFx0XHR7XG5cdFx0XHRcdHRpdGxlOiBgWW91IGhhdmUgYmVlbiBmb3JnaXZlbmAsXG5cdFx0XHRcdHRodW1ibmFpbDoge1xuXHRcdFx0XHRcdHVybDogbWVtYmVyLmRpc3BsYXlBdmF0YXJVUkwoKVxuXHRcdFx0XHR9LFxuXHRcdFx0XHRkZXNjcmlwdGlvbjogcmVhc29uID8/ICcnLFxuXHRcdFx0XHRjb2xvcjogQ29sb3JzLkdyZWVuLFxuXHRcdFx0XHRmb290ZXI6IHtcblx0XHRcdFx0XHR0ZXh0OiAn4pyFIFlvdSBub3cgaGF2ZSAwIGluZnJhY3Rpb25zLidcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdF1cblx0fVxuXG5cdC8vIExvZyBhY3Rpb24gdG8gbW9kbG9ncyBjaGFubmVsIGlmIHRoaXMgaXMgbm90IGl0XG5cdGNvbnN0IHsgbG9nc0NoYW5uZWxJZCwgdGVzdE1vZGUgfSA9IGdldFNldHRpbmdzKGludGVyYWN0aW9uLmd1aWxkSWQpXG5cdGlmIChpbnRlcmFjdGlvbi5jaGFubmVsSWQgIT09IGxvZ3NDaGFubmVsSWQpIHtcblx0XHRjb25zdCB0ZXN0UHJlZml4ID0gdGVzdE1vZGUgPyAnW1RFU1RdICcgOiAnJ1xuXHRcdGxvZ0FjdGlvbihpbnRlcmFjdGlvbi5ndWlsZElkLCB7XG5cdFx0XHRlbWJlZHM6IFtcblx0XHRcdFx0e1xuXHRcdFx0XHRcdHRpdGxlOiB0ZXN0UHJlZml4ICsgYE1lbWJlciBmb3JnaXZlbmAsXG5cdFx0XHRcdFx0dGh1bWJuYWlsOiB7XG5cdFx0XHRcdFx0XHR1cmw6IG1lbWJlci5kaXNwbGF5QXZhdGFyVVJMKClcblx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdGRlc2NyaXB0aW9uOiBgJHttZW1iZXJ9IGhhcyBiZWVuIGZvcmdpdmVuYCxcblx0XHRcdFx0XHRjb2xvcjogQ29sb3JzLkdyZWVuLFxuXHRcdFx0XHRcdHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuXHRcdFx0XHRcdGZvb3Rlcjoge1xuXHRcdFx0XHRcdFx0aWNvbl91cmw6IGludGVyYWN0aW9uLnVzZXIuZGlzcGxheUF2YXRhclVSTCgpLFxuXHRcdFx0XHRcdFx0dGV4dDogJ2J5IEAnICsgaW50ZXJhY3Rpb24udXNlci51c2VybmFtZVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0XVxuXHRcdH0pXG5cdH1cblxuXHQvLyBUZXN0IG1vZGUgLSBkb24ndCBhY3R1YWxseSBmb3JnaXZlXG5cdGlmICh0ZXN0TW9kZSkge1xuXHRcdHJldHVybiB7XG5cdFx0XHRlbWJlZHM6IFtcblx0XHRcdFx0e1xuXHRcdFx0XHRcdHRpdGxlOiAnVGVzdCBtb2RlJyxcblx0XHRcdFx0XHRkZXNjcmlwdGlvbjogJ1RoaXMgaXMgYSB0ZXN0LiBObyBhY3Rpb24gaGFzIGJlZW4gdGFrZW4uJyxcblx0XHRcdFx0XHRjb2xvcjogQ29sb3JzLlllbGxvdyxcblx0XHRcdFx0XHRmb290ZXI6IHtcblx0XHRcdFx0XHRcdHRleHQ6IChsb2dzQ2hhbm5lbElkID8gJ1NlZScgOiAnU2V0dXAnKSArIGAgbW9kbG9ncyBjaGFubmVsIGZvciBkZXRhaWxzYFxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0XSxcblx0XHRcdGVwaGVtZXJhbDogdHJ1ZVxuXHRcdH1cblx0fVxuXG5cdC8vIFVwZGF0ZSBpbmZyYWN0aW9uc1xuXHRhd2FpdCBGbGFzaGNvcmUuc2V0KCdpbmZyYWN0aW9ucycsIDAsIHtcblx0XHRuYW1lc3BhY2U6IGludGVyYWN0aW9uLmd1aWxkSWQgKyBtZW1iZXIuaWRcblx0fSlcblxuXHRpZiAoYW5vbnltb3VzKSB7XG5cdFx0YXdhaXQgaW50ZXJhY3Rpb24uY2hhbm5lbD8uc2VuZChtZXNzYWdlUGF5bG9hZCBhcyBNZXNzYWdlQ3JlYXRlT3B0aW9ucylcblxuXHRcdHJldHVybiB7XG5cdFx0XHRjb250ZW50OiAnU3RyaWtlcyBoYXZlIGJlZW4gY2xlYXJlZCBmb3IgJyArIG1lbWJlci51c2VyLnVzZXJuYW1lLFxuXHRcdFx0ZXBoZW1lcmFsOiB0cnVlXG5cdFx0fVxuXHR9XG5cblx0cmV0dXJuIG1lc3NhZ2VQYXlsb2FkXG59XG4iXSwibmFtZXMiOlsiaGFzUGVybWlzc2lvbiIsImxvZ0FjdGlvbiIsImdldFNldHRpbmdzIiwiRmxhc2hjb3JlIiwiY29sb3IiLCJsb2dnZXIiLCJDb2xvcnMiLCJQZXJtaXNzaW9uRmxhZ3NCaXRzIiwiY29uZmlnIiwiZGVmYXVsdE1lbWJlclBlcm1pc3Npb25zIiwiTW9kZXJhdGVNZW1iZXJzIiwiZGVzY3JpcHRpb24iLCJkbVBlcm1pc3Npb24iLCJvcHRpb25zIiwibmFtZSIsInR5cGUiLCJyZXF1aXJlZCIsImludGVyYWN0aW9uIiwiYW5vbnltb3VzIiwiZ2V0IiwidmFsdWUiLCJtZW1iZXIiLCJyZWFzb24iLCJkZWJ1ZyIsInVzZXIiLCJ1c2VybmFtZSIsImJvbGQiLCJjb250ZW50IiwiZXBoZW1lcmFsIiwibWVzc2FnZVBheWxvYWQiLCJ0b1N0cmluZyIsImVtYmVkcyIsInRpdGxlIiwidGh1bWJuYWlsIiwidXJsIiwiZGlzcGxheUF2YXRhclVSTCIsIkdyZWVuIiwiZm9vdGVyIiwidGV4dCIsImxvZ3NDaGFubmVsSWQiLCJ0ZXN0TW9kZSIsImd1aWxkSWQiLCJjaGFubmVsSWQiLCJ0ZXN0UHJlZml4IiwidGltZXN0YW1wIiwiRGF0ZSIsInRvSVNPU3RyaW5nIiwiaWNvbl91cmwiLCJZZWxsb3ciLCJzZXQiLCJuYW1lc3BhY2UiLCJpZCIsImNoYW5uZWwiLCJzZW5kIl0sIm1hcHBpbmdzIjoiQUFBQSxTQUFTQSxhQUFhLEVBQUVDLFNBQVMsUUFBUSxzQkFBcUI7QUFDOUQsU0FBU0MsV0FBVyxRQUFRLHlCQUF3QjtBQUNwRCxTQUFTQyxTQUFTLEVBQUVDLEtBQUssRUFBRUMsTUFBTSxRQUFRLFVBQVM7QUFDbEQsU0FBU0MsTUFBTSxFQUFFQyxtQkFBbUIsUUFBUSxhQUFZO0FBSXhELE9BQU8sTUFBTUMsU0FBd0I7SUFDcENDLDBCQUEwQkYsb0JBQW9CRyxlQUFlO0lBQzdEQyxhQUFhLENBQUMsd0NBQXdD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