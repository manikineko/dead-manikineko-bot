import { Buttons, ID_NAMESPACE } from '../../core/constants.js';
import { getSettings } from '../../core/settings.js';
import { hasPermission, logAction } from '../../core/utils.js';
import { Flashcore, logger } from 'robo.js';
import { ButtonStyle, Colors, ComponentType } from 'discord.js';
export const config = {
    description: `Bans a user when clicked`
};
export default (async (interaction)=>{
    // Only handle interaction meant for this file
    if (!interaction.isButton() || !interaction.customId.startsWith(Buttons.Ban.id)) {
        return;
    }
    await interaction.deferUpdate();
    // Validate the event
    if (!interaction.guild) {
        return 'This command can only be used in a server';
    }
    // Get settings
    const { logsChannelId , testMode  } = getSettings(interaction.guildId);
    // Validate permissions
    if (!hasPermission(interaction, 'BanMembers')) {
        logger.debug(`User @${interaction.user.username} does not have permission to unban users`);
        return interaction.followUp({
            content: `You don't have permission to use this.`,
            ephemeral: true
        });
    }
    // Do the actual ban - Farewell forever!
    const parts = interaction.customId.split('/');
    const userId = parts[parts.length - 1];
    if (!testMode) {
        await interaction.guild.members.ban(userId);
        await Flashcore.set('ban', {}, {
            namespace: ID_NAMESPACE + interaction.guildId + userId
        });
        logger.info(`Banned <@${userId}> in guild ${interaction.guild.name} by @${interaction.user.username}`);
    }
    // Get user data
    const user = await interaction.client.users.fetch(userId);
    // Log action to modlogs channel
    if (interaction.channelId !== logsChannelId) {
        const testPrefix = testMode ? '[TEST] ' : '';
        logAction(interaction.guildId, {
            embeds: [
                {
                    title: testPrefix + `Member banned`,
                    thumbnail: {
                        url: user.displayAvatarURL()
                    },
                    description: `${user} has been banned`,
                    color: Colors.DarkRed,
                    timestamp: new Date().toISOString(),
                    footer: {
                        icon_url: interaction.user.displayAvatarURL(),
                        text: 'by @' + interaction.user.username
                    }
                }
            ]
        });
    }
    // Test mode - don't execute ban
    if (testMode) {
        return interaction.followUp({
            embeds: [
                {
                    title: 'Test mode',
                    description: 'This is a test. No action has been taken.',
                    color: Colors.Yellow,
                    footer: {
                        text: (logsChannelId ? 'See' : 'Setup') + ` modlogs channel for details`
                    }
                }
            ],
            ephemeral: true
        });
    }
    return interaction.followUp({
        embeds: [
            {
                color: Colors.DarkRed,
                title: `${user.username} was banned`,
                thumbnail: {
                    url: user.displayAvatarURL()
                },
                fields: [
                    {
                        name: 'Member',
                        value: user.toString()
                    }
                ]
            }
        ],
        components: [
            {
                type: ComponentType.ActionRow,
                components: [
                    {
                        type: ComponentType.Button,
                        label: 'Unban',
                        style: ButtonStyle.Danger,
                        customId: Buttons.Unban.id + '/' + user.id
                    }
                ]
            }
        ]
    });
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL3J1bm5lci93b3JrL3JvYm8uanMvcm9iby5qcy9wYWNrYWdlcy9wbHVnaW4tbW9kdG9vbHMvc3JjL2V2ZW50cy9pbnRlcmFjdGlvbkNyZWF0ZS9idXR0b24tYmFuLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEJ1dHRvbnMsIElEX05BTUVTUEFDRSB9IGZyb20gJy4uLy4uL2NvcmUvY29uc3RhbnRzLmpzJ1xuaW1wb3J0IHsgZ2V0U2V0dGluZ3MgfSBmcm9tICcuLi8uLi9jb3JlL3NldHRpbmdzLmpzJ1xuaW1wb3J0IHsgaGFzUGVybWlzc2lvbiwgbG9nQWN0aW9uIH0gZnJvbSAnLi4vLi4vY29yZS91dGlscy5qcydcbmltcG9ydCB7IEZsYXNoY29yZSwgbG9nZ2VyIH0gZnJvbSAncm9iby5qcydcbmltcG9ydCB7IEJ1dHRvblN0eWxlLCBDb2xvcnMsIENvbXBvbmVudFR5cGUgfSBmcm9tICdkaXNjb3JkLmpzJ1xuaW1wb3J0IHR5cGUgeyBFdmVudENvbmZpZyB9IGZyb20gJ3JvYm8uanMnXG5pbXBvcnQgdHlwZSB7IEJ1dHRvbkludGVyYWN0aW9uIH0gZnJvbSAnZGlzY29yZC5qcydcblxuZXhwb3J0IGNvbnN0IGNvbmZpZzogRXZlbnRDb25maWcgPSB7XG5cdGRlc2NyaXB0aW9uOiBgQmFucyBhIHVzZXIgd2hlbiBjbGlja2VkYFxufVxuXG5leHBvcnQgZGVmYXVsdCBhc3luYyAoaW50ZXJhY3Rpb246IEJ1dHRvbkludGVyYWN0aW9uKSA9PiB7XG5cdC8vIE9ubHkgaGFuZGxlIGludGVyYWN0aW9uIG1lYW50IGZvciB0aGlzIGZpbGVcblx0aWYgKCFpbnRlcmFjdGlvbi5pc0J1dHRvbigpIHx8ICFpbnRlcmFjdGlvbi5jdXN0b21JZC5zdGFydHNXaXRoKEJ1dHRvbnMuQmFuLmlkKSkge1xuXHRcdHJldHVyblxuXHR9XG5cdGF3YWl0IGludGVyYWN0aW9uLmRlZmVyVXBkYXRlKClcblxuXHQvLyBWYWxpZGF0ZSB0aGUgZXZlbnRcblx0aWYgKCFpbnRlcmFjdGlvbi5ndWlsZCkge1xuXHRcdHJldHVybiAnVGhpcyBjb21tYW5kIGNhbiBvbmx5IGJlIHVzZWQgaW4gYSBzZXJ2ZXInXG5cdH1cblxuXHQvLyBHZXQgc2V0dGluZ3Ncblx0Y29uc3QgeyBsb2dzQ2hhbm5lbElkLCB0ZXN0TW9kZSB9ID0gZ2V0U2V0dGluZ3MoaW50ZXJhY3Rpb24uZ3VpbGRJZClcblxuXHQvLyBWYWxpZGF0ZSBwZXJtaXNzaW9uc1xuXHRpZiAoIWhhc1Blcm1pc3Npb24oaW50ZXJhY3Rpb24sICdCYW5NZW1iZXJzJykpIHtcblx0XHRsb2dnZXIuZGVidWcoYFVzZXIgQCR7aW50ZXJhY3Rpb24udXNlci51c2VybmFtZX0gZG9lcyBub3QgaGF2ZSBwZXJtaXNzaW9uIHRvIHVuYmFuIHVzZXJzYClcblx0XHRyZXR1cm4gaW50ZXJhY3Rpb24uZm9sbG93VXAoe1xuXHRcdFx0Y29udGVudDogYFlvdSBkb24ndCBoYXZlIHBlcm1pc3Npb24gdG8gdXNlIHRoaXMuYCxcblx0XHRcdGVwaGVtZXJhbDogdHJ1ZVxuXHRcdH0pXG5cdH1cblxuXHQvLyBEbyB0aGUgYWN0dWFsIGJhbiAtIEZhcmV3ZWxsIGZvcmV2ZXIhXG5cdGNvbnN0IHBhcnRzID0gaW50ZXJhY3Rpb24uY3VzdG9tSWQuc3BsaXQoJy8nKVxuXHRjb25zdCB1c2VySWQgPSBwYXJ0c1twYXJ0cy5sZW5ndGggLSAxXVxuXG5cdGlmICghdGVzdE1vZGUpIHtcblx0XHRhd2FpdCBpbnRlcmFjdGlvbi5ndWlsZC5tZW1iZXJzLmJhbih1c2VySWQpXG5cdFx0YXdhaXQgRmxhc2hjb3JlLnNldChcblx0XHRcdCdiYW4nLFxuXHRcdFx0e30sXG5cdFx0XHR7XG5cdFx0XHRcdG5hbWVzcGFjZTogSURfTkFNRVNQQUNFICsgaW50ZXJhY3Rpb24uZ3VpbGRJZCArIHVzZXJJZFxuXHRcdFx0fVxuXHRcdClcblx0XHRsb2dnZXIuaW5mbyhgQmFubmVkIDxAJHt1c2VySWR9PiBpbiBndWlsZCAke2ludGVyYWN0aW9uLmd1aWxkLm5hbWV9IGJ5IEAke2ludGVyYWN0aW9uLnVzZXIudXNlcm5hbWV9YClcblx0fVxuXG5cdC8vIEdldCB1c2VyIGRhdGFcblx0Y29uc3QgdXNlciA9IGF3YWl0IGludGVyYWN0aW9uLmNsaWVudC51c2Vycy5mZXRjaCh1c2VySWQpXG5cblx0Ly8gTG9nIGFjdGlvbiB0byBtb2Rsb2dzIGNoYW5uZWxcblx0aWYgKGludGVyYWN0aW9uLmNoYW5uZWxJZCAhPT0gbG9nc0NoYW5uZWxJZCkge1xuXHRcdGNvbnN0IHRlc3RQcmVmaXggPSB0ZXN0TW9kZSA/ICdbVEVTVF0gJyA6ICcnXG5cdFx0bG9nQWN0aW9uKGludGVyYWN0aW9uLmd1aWxkSWQsIHtcblx0XHRcdGVtYmVkczogW1xuXHRcdFx0XHR7XG5cdFx0XHRcdFx0dGl0bGU6IHRlc3RQcmVmaXggKyBgTWVtYmVyIGJhbm5lZGAsXG5cdFx0XHRcdFx0dGh1bWJuYWlsOiB7XG5cdFx0XHRcdFx0XHR1cmw6IHVzZXIuZGlzcGxheUF2YXRhclVSTCgpXG5cdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRkZXNjcmlwdGlvbjogYCR7dXNlcn0gaGFzIGJlZW4gYmFubmVkYCxcblx0XHRcdFx0XHRjb2xvcjogQ29sb3JzLkRhcmtSZWQsXG5cdFx0XHRcdFx0dGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG5cdFx0XHRcdFx0Zm9vdGVyOiB7XG5cdFx0XHRcdFx0XHRpY29uX3VybDogaW50ZXJhY3Rpb24udXNlci5kaXNwbGF5QXZhdGFyVVJMKCksXG5cdFx0XHRcdFx0XHR0ZXh0OiAnYnkgQCcgKyBpbnRlcmFjdGlvbi51c2VyLnVzZXJuYW1lXG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHRdXG5cdFx0fSlcblx0fVxuXG5cdC8vIFRlc3QgbW9kZSAtIGRvbid0IGV4ZWN1dGUgYmFuXG5cdGlmICh0ZXN0TW9kZSkge1xuXHRcdHJldHVybiBpbnRlcmFjdGlvbi5mb2xsb3dVcCh7XG5cdFx0XHRlbWJlZHM6IFtcblx0XHRcdFx0e1xuXHRcdFx0XHRcdHRpdGxlOiAnVGVzdCBtb2RlJyxcblx0XHRcdFx0XHRkZXNjcmlwdGlvbjogJ1RoaXMgaXMgYSB0ZXN0LiBObyBhY3Rpb24gaGFzIGJlZW4gdGFrZW4uJyxcblx0XHRcdFx0XHRjb2xvcjogQ29sb3JzLlllbGxvdyxcblx0XHRcdFx0XHRmb290ZXI6IHtcblx0XHRcdFx0XHRcdHRleHQ6IChsb2dzQ2hhbm5lbElkID8gJ1NlZScgOiAnU2V0dXAnKSArIGAgbW9kbG9ncyBjaGFubmVsIGZvciBkZXRhaWxzYFxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0XSxcblx0XHRcdGVwaGVtZXJhbDogdHJ1ZVxuXHRcdH0pXG5cdH1cblxuXHRyZXR1cm4gaW50ZXJhY3Rpb24uZm9sbG93VXAoe1xuXHRcdGVtYmVkczogW1xuXHRcdFx0e1xuXHRcdFx0XHRjb2xvcjogQ29sb3JzLkRhcmtSZWQsXG5cdFx0XHRcdHRpdGxlOiBgJHt1c2VyLnVzZXJuYW1lfSB3YXMgYmFubmVkYCxcblx0XHRcdFx0dGh1bWJuYWlsOiB7XG5cdFx0XHRcdFx0dXJsOiB1c2VyLmRpc3BsYXlBdmF0YXJVUkwoKVxuXHRcdFx0XHR9LFxuXHRcdFx0XHRmaWVsZHM6IFtcblx0XHRcdFx0XHR7XG5cdFx0XHRcdFx0XHRuYW1lOiAnTWVtYmVyJyxcblx0XHRcdFx0XHRcdHZhbHVlOiB1c2VyLnRvU3RyaW5nKClcblx0XHRcdFx0XHR9XG5cdFx0XHRcdF1cblx0XHRcdH1cblx0XHRdLFxuXHRcdGNvbXBvbmVudHM6IFtcblx0XHRcdHtcblx0XHRcdFx0dHlwZTogQ29tcG9uZW50VHlwZS5BY3Rpb25Sb3csXG5cdFx0XHRcdGNvbXBvbmVudHM6IFtcblx0XHRcdFx0XHR7XG5cdFx0XHRcdFx0XHR0eXBlOiBDb21wb25lbnRUeXBlLkJ1dHRvbixcblx0XHRcdFx0XHRcdGxhYmVsOiAnVW5iYW4nLFxuXHRcdFx0XHRcdFx0c3R5bGU6IEJ1dHRvblN0eWxlLkRhbmdlcixcblx0XHRcdFx0XHRcdGN1c3RvbUlkOiBCdXR0b25zLlVuYmFuLmlkICsgJy8nICsgdXNlci5pZFxuXHRcdFx0XHRcdH1cblx0XHRcdFx0XVxuXHRcdFx0fVxuXHRcdF1cblx0fSlcbn1cbiJdLCJuYW1lcyI6WyJCdXR0b25zIiwiSURfTkFNRVNQQUNFIiwiZ2V0U2V0dGluZ3MiLCJoYXNQZXJtaXNzaW9uIiwibG9nQWN0aW9uIiwiRmxhc2hjb3JlIiwibG9nZ2VyIiwiQnV0dG9uU3R5bGUiLCJDb2xvcnMiLCJDb21wb25lbnRUeXBlIiwiY29uZmlnIiwiZGVzY3JpcHRpb24iLCJpbnRlcmFjdGlvbiIsImlzQnV0dG9uIiwiY3VzdG9tSWQiLCJzdGFydHNXaXRoIiwiQmFuIiwiaWQiLCJkZWZlclVwZGF0ZSIsImd1aWxkIiwibG9nc0NoYW5uZWxJZCIsInRlc3RNb2RlIiwiZ3VpbGRJZCIsImRlYnVnIiwidXNlciIsInVzZXJuYW1lIiwiZm9sbG93VXAiLCJjb250ZW50IiwiZXBoZW1lcmFsIiwicGFydHMiLCJzcGxpdCIsInVzZXJJZCIsImxlbmd0aCIsIm1lbWJlcnMiLCJiYW4iLCJzZXQiLCJuYW1lc3BhY2UiLCJpbmZvIiwibmFtZSIsImNsaWVudCIsInVzZXJzIiwiZmV0Y2giLCJjaGFubmVsSWQiLCJ0ZXN0UHJlZml4IiwiZW1iZWRzIiwidGl0bGUiLCJ0aHVtYm5haWwiLCJ1cmwiLCJkaXNwbGF5QXZhdGFyVVJMIiwiY29sb3IiLCJEYXJrUmVkIiwidGltZXN0YW1wIiwiRGF0ZSIsInRvSVNPU3RyaW5nIiwiZm9vdGVyIiwiaWNvbl91cmwiLCJ0ZXh0IiwiWWVsbG93IiwiZmllbGRzIiwidmFsdWUiLCJ0b1N0cmluZyIsImNvbXBvbmVudHMiLCJ0eXBlIiwiQWN0aW9uUm93IiwiQnV0dG9uIiwibGFiZWwiLCJzdHlsZSIsIkRhbmdlciIsIlVuYmFuIl0sIm1hcHBpbmdzIjoiQUFBQSxTQUFTQSxPQUFPLEVBQUVDLFlBQVksUUFBUSwwQkFBeUI7QUFDL0QsU0FBU0MsV0FBVyxRQUFRLHlCQUF3QjtBQUNwRCxTQUFTQyxhQUFhLEVBQUVDLFNBQVMsUUFBUSxzQkFBcUI7QUFDOUQsU0FBU0MsU0FBUyxFQUFFQyxNQUFNLFFBQVEsVUFBUztBQUMzQyxTQUFTQyxXQUFXLEVBQUVDLE1BQU0sRUFBRUMsYUFBYSxRQUFRLGFBQVk7QUFJL0QsT0FBTyxNQUFNQyxTQUFzQjtJQUNsQ0MsYUFBYSxDQUFDLHdCQUF3QixDQUFDO0FBQ3hDLEVBQUM7QUFFRCxlQUFlLENBQUEsT0FBT0MsY0FBbUM7SUFDeEQsOENBQThDO0lBQzlDLElBQUksQ0FBQ0EsWUFBWUMsUUFBUSxNQUFNLENBQUNELFlBQVlFLFFBQVEsQ0FBQ0MsVUFBVSxDQUFDZixRQUFRZ0IsR0FBRyxDQUFDQyxFQUFFLEdBQUc7UUFDaEY7SUFDRCxDQUFDO0lBQ0QsTUFBTUwsWUFBWU0sV0FBVztJQUU3QixxQkFBcUI7SUFDckIsSUFBSSxDQUFDTixZQUFZTyxLQUFLLEVBQUU7UUFDdkIsT0FBTztJQUNSLENBQUM7SUFFRCxlQUFlO0lBQ2YsTUFBTSxFQUFFQyxjQUFhLEVBQUVDLFNBQVEsRUFBRSxHQUFHbkIsWUFBWVUsWUFBWVUsT0FBTztJQUVuRSx1QkFBdUI7SUFDdkIsSUFBSSxDQUFDbkIsY0FBY1MsYUFBYSxlQUFlO1FBQzlDTixPQUFPaUIsS0FBSyxDQUFDLENBQUMsTUFBTSxFQUFFWCxZQUFZWSxJQUFJLENBQUNDLFFBQVEsQ0FBQyx3Q0FBd0MsQ0FBQztRQUN6RixPQUFPYixZQUFZYyxRQUFRLENBQUM7WUFDM0JDLFNBQVMsQ0FBQyxzQ0FBc0MsQ0FBQztZQUNqREMsV0FBVyxJQUFJO1FBQ2hCO0lBQ0QsQ0FBQztJQUVELHdDQUF3QztJQUN4QyxNQUFNQyxRQUFRakIsWUFBWUUsUUFBUSxDQUFDZ0IsS0FBSyxDQUFDO0lBQ3pDLE1BQU1DLFNBQVNGLEtBQUssQ0FBQ0EsTUFBTUcsTUFBTSxHQUFHLEVBQUU7SUFFdEMsSUFBSSxDQUFDWCxVQUFVO1FBQ2QsTUFBTVQsWUFBWU8sS0FBSyxDQUFDYyxPQUFPLENBQUNDLEdBQUcsQ0FBQ0g7UUFDcEMsTUFBTTFCLFVBQVU4QixHQUFHLENBQ2xCLE9BQ0EsQ0FBQyxHQUNEO1lBQ0NDLFdBQVduQyxlQUFlVyxZQUFZVSxPQUFPLEdBQUdTO1FBQ2pEO1FBRUR6QixPQUFPK0IsSUFBSSxDQUFDLENBQUMsU0FBUyxFQUFFTixPQUFPLFdBQVcsRUFBRW5CLFlBQVlPLEtBQUssQ0FBQ21CLElBQUksQ0FBQyxLQUFLLEVBQUUxQixZQUFZWSxJQUFJLENBQUNDLFFBQVEsQ0FBQyxDQUFDO0lBQ3RHLENBQUM7SUFFRCxnQkFBZ0I7SUFDaEIsTUFBTUQsT0FBTyxNQUFNWixZQUFZMkIsTUFBTSxDQUFDQyxLQUFLLENBQUNDLEtBQUssQ0FBQ1Y7SUFFbEQsZ0NBQWdDO0lBQ2hDLElBQUluQixZQUFZOEIsU0FBUyxLQUFLdEIsZUFBZTtRQUM1QyxNQUFNdUIsYUFBYXRCLFdBQVcsWUFBWSxFQUFFO1FBQzVDakIsVUFBVVEsWUFBWVUsT0FBTyxFQUFFO1lBQzlCc0IsUUFBUTtnQkFDUDtvQkFDQ0MsT0FBT0YsYUFBYSxDQUFDLGFBQWEsQ0FBQztvQkFDbkNHLFdBQVc7d0JBQ1ZDLEtBQUt2QixLQUFLd0IsZ0JBQWdCO29CQUMzQjtvQkFDQXJDLGFBQWEsQ0FBQyxFQUFFYSxLQUFLLGdCQUFnQixDQUFDO29CQUN0Q3lCLE9BQU96QyxPQUFPMEMsT0FBTztvQkFDckJDLFdBQVcsSUFBSUMsT0FBT0MsV0FBVztvQkFDakNDLFFBQVE7d0JBQ1BDLFVBQVUzQyxZQUFZWSxJQUFJLENBQUN3QixnQkFBZ0I7d0JBQzNDUSxNQUFNLFNBQVM1QyxZQUFZWSxJQUFJLENBQUNDLFFBQVE7b0JBQ3pDO2dCQUNEO2FBQ0E7UUFDRjtJQUNELENBQUM7SUFFRCxnQ0FBZ0M7SUFDaEMsSUFBSUosVUFBVTtRQUNiLE9BQU9ULFlBQVljLFFBQVEsQ0FBQztZQUMzQmtCLFFBQVE7Z0JBQ1A7b0JBQ0NDLE9BQU87b0JBQ1BsQyxhQUFhO29CQUNic0MsT0FBT3pDLE9BQU9pRCxNQUFNO29CQUNwQkgsUUFBUTt3QkFDUEUsTUFBTSxBQUFDcEMsQ0FBQUEsZ0JBQWdCLFFBQVEsT0FBTyxBQUFELElBQUssQ0FBQyw0QkFBNEIsQ0FBQztvQkFDekU7Z0JBQ0Q7YUFDQTtZQUNEUSxXQUFXLElBQUk7UUFDaEI7SUFDRCxDQUFDO0lBRUQsT0FBT2hCLFlBQVljLFFBQVEsQ0FBQztRQUMzQmtCLFFBQVE7WUFDUDtnQkFDQ0ssT0FBT3pDLE9BQU8wQyxPQUFPO2dCQUNyQkwsT0FBTyxDQUFDLEVBQUVyQixLQUFLQyxRQUFRLENBQUMsV0FBVyxDQUFDO2dCQUNwQ3FCLFdBQVc7b0JBQ1ZDLEtBQUt2QixLQUFLd0IsZ0JBQWdCO2dCQUMzQjtnQkFDQVUsUUFBUTtvQkFDUDt3QkFDQ3BCLE1BQU07d0JBQ05xQixPQUFPbkMsS0FBS29DLFFBQVE7b0JBQ3JCO2lCQUNBO1lBQ0Y7U0FDQTtRQUNEQyxZQUFZO1lBQ1g7Z0JBQ0NDLE1BQU1yRCxjQUFjc0QsU0FBUztnQkFDN0JGLFlBQVk7b0JBQ1g7d0JBQ0NDLE1BQU1yRCxjQUFjdUQsTUFBTTt3QkFDMUJDLE9BQU87d0JBQ1BDLE9BQU8zRCxZQUFZNEQsTUFBTTt3QkFDekJyRCxVQUFVZCxRQUFRb0UsS0FBSyxDQUFDbkQsRUFBRSxHQUFHLE1BQU1PLEtBQUtQLEVBQUU7b0JBQzNDO2lCQUNBO1lBQ0Y7U0FDQTtJQUNGO0FBQ0QsQ0FBQSxFQUFDIn0=