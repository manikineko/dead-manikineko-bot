import { RoboResponse } from "./robo-response.js";
import { logger } from "./logger.js";
import { pluginOptions } from "../events/_start.js";
import { mimeDb } from "./mime.js";
import { createReadStream } from "node:fs";
import { readdir, stat } from "node:fs/promises";
import path from "node:path";
import { pipeline } from "node:stream/promises";
import url from "node:url";
import { parse } from "node:querystring";
import { color } from "robo.js";
const MAX_BODY_SIZE = 5 * 1024 * 1024 // 5MB
;
const BodyMethods = [
    'PATCH',
    'POST',
    'PUT'
];
const PublicPath = path.join(process.cwd(), 'public');
const PublicBuildPath = path.join(process.cwd(), '.robo', 'public');
export function createServerHandler(router, vite) {
    const { parseBody =true  } = pluginOptions;
    return async (req, res)=>{
        const parsedUrl = url.parse(req.url, true);
        if (pluginOptions.cors) {
            // CORS Headers (to allow any origin, any method, and any header)
            res.setHeader('Access-Control-Allow-Origin', '*');
            res.setHeader('Access-Control-Allow-Methods', '*');
            res.setHeader('Access-Control-Allow-Headers', '*');
            // Preflight request. Reply successfully:
            if (req.method === 'OPTIONS') {
                res.writeHead(200);
                res.end();
                return;
            }
        }
        // Parse request body if applicable
        let body;
        if (parseBody && BodyMethods.includes(req.method)) {
            try {
                body = await getRequestBody(req);
            } catch (err) {
                logger.error(`Error in parsing request body: ${err}`);
                res.statusCode = 400;
                res.end('Invalid request body.');
                return;
            }
        }
        // Prepare request and reply wrappers for easier usage
        const requestWrapper = {
            req,
            body: body,
            method: req.method,
            query: {},
            params: {} // to be filled by the route handler
        };
        // Parse query string if applicable
        const queryIndex = req.url?.indexOf('?') ?? -1;
        if (queryIndex !== -1) {
            requestWrapper.query = parse(req.url.substring(queryIndex + 1));
        }
        const replyWrapper = {
            res,
            hasSent: false,
            code: function(statusCode) {
                this.res.statusCode = statusCode;
                return this;
            },
            json: function(data) {
                this.res.setHeader('Content-Type', 'application/json');
                this.res.end(JSON.stringify(data));
                this.hasSent = true;
                return this;
            },
            send: function(data) {
                this.res.end(data);
                this.hasSent = true;
                return this;
            },
            header: function(name, value) {
                this.res.setHeader(name, value);
                return this;
            }
        };
        // Find matching route and execute handler
        logger.debug(color.bold(req.method), req.url);
        const route = router.find(parsedUrl.pathname);
        requestWrapper.params = route?.params ?? {};
        // If Vite is available, forward the request to Vite
        if (!route?.handler && vite) {
            logger.debug(`Forwarding to Vite:`, req.url);
            vite.middlewares(req, res);
            return;
        }
        // If route missing, check if we can return something from the public folder
        if (!route?.handler) {
            try {
                const callback = async (filePath, mimeType)=>{
                    res.setHeader('Content-Type', mimeType);
                    res.setHeader('X-Content-Type-Options', 'nosniff');
                    res.writeHead(200);
                    await pipeline(createReadStream(filePath), res);
                };
                if (await handlePublicFile(parsedUrl, callback)) {
                    return;
                }
            } catch (error) {
                if (error instanceof RoboResponse) {
                    if (error?.status >= 400) {
                        logger.error(error);
                    }
                    Object.entries(error.headers ?? {}).forEach(([key, value])=>{
                        replyWrapper.header(key, value);
                    });
                    replyWrapper.code(error.status ?? 500).json(error.data ?? error.message);
                } else {
                    logger.error(error);
                }
            }
        }
        if (!route?.handler) {
            replyWrapper.code(404).json('API Route not found.');
            return;
        }
        try {
            const result = await route.handler(requestWrapper, replyWrapper);
            if (!replyWrapper.hasSent && result) {
                replyWrapper.code(200).json(result);
            }
        } catch (error) {
            if (error instanceof RoboResponse) {
                if (error?.status >= 400) {
                    logger.error(error);
                }
                Object.entries(error.headers ?? {}).forEach(([key, value])=>{
                    replyWrapper.header(key, value);
                });
                replyWrapper.code(error.status ?? 500).json(error.data ?? error.message);
            } else if (error instanceof Error) {
                logger.error(error);
                replyWrapper.code(500).json(error.message ?? 'Server encountered an error.');
            } else {
                logger.error(error);
                replyWrapper.code(500).send('Server encountered an error.');
            }
        }
    };
}
export async function getRequestBody(req) {
    return new Promise((resolve, reject)=>{
        let body = '';
        let size = 0;
        req.on('data', (chunk)=>{
            size += chunk.length;
            if (size > MAX_BODY_SIZE) {
                reject(new Error('Request body is too large'));
                return;
            }
            body += chunk;
        });
        req.on('end', ()=>{
            // It's okay to have empty body <3
            if (!body) {
                resolve({});
                return;
            }
            try {
                const parsedBody = JSON.parse(body);
                resolve(parsedBody);
            } catch (err) {
                reject(new Error('Invalid JSON data'));
            }
        });
    });
}
export async function handlePublicFile(parsedUrl, callback) {
    // Determine which public folder to use (production or development)
    const publicPath = process.env.NODE_ENV === 'production' ? PublicBuildPath : PublicPath;
    const filePath = decodeURI(path.join(publicPath, parsedUrl.pathname));
    // Check if the requested path is within the public folder to guard against directory traversal
    if (!filePath.startsWith(publicPath)) {
        logger.warn(`Requested path is outside the public folder. Denying access...`);
        throw new RoboResponse({
            status: 403,
            message: 'Access Denied'
        });
    }
    // See if the file exists
    try {
        const stats = await stat(filePath);
        if (stats.isFile()) {
            logger.debug(`Serving public file: ${filePath}`);
            const ext = path.extname(filePath).slice(1);
            const mimeType = mimeDb[ext] ?? 'application/octet-stream';
            await callback(filePath, mimeType);
            return true;
        } else if (stats.isDirectory()) {
            // Look for an index file in the directory
            const files = await readdir(filePath);
            const indexExtensions = [
                'html',
                'htm',
                'php',
                'js',
                'json'
            ];
            const indexFile = files.find((file)=>{
                const extension = path.extname(file).slice(1);
                return indexExtensions.includes(extension) && file.startsWith('index.');
            });
            if (indexFile) {
                const indexFilePath = path.join(filePath, indexFile);
                const ext = path.extname(indexFilePath).slice(1);
                const mimeType = mimeDb[ext] ?? 'application/octet-stream';
                logger.debug('Serving public index file:', indexFilePath);
                await callback(indexFilePath, mimeType);
                return true;
            }
        }
    } catch (error) {
        // Ignore ENOENT errors (file not found)
        if (error.code !== 'ENOENT') {
            throw error;
        }
    }
    return false;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL3J1bm5lci93b3JrL3JvYm8uanMvcm9iby5qcy9wYWNrYWdlcy9wbHVnaW4tYXBpL3NyYy9jb3JlL2hhbmRsZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUm9ib1Jlc3BvbnNlIH0gZnJvbSAnLi9yb2JvLXJlc3BvbnNlLmpzJ1xuaW1wb3J0IHsgbG9nZ2VyIH0gZnJvbSAnLi9sb2dnZXIuanMnXG5pbXBvcnQgeyBwbHVnaW5PcHRpb25zIH0gZnJvbSAnLi4vZXZlbnRzL19zdGFydC5qcydcbmltcG9ydCB7IG1pbWVEYiB9IGZyb20gJy4vbWltZS5qcydcbmltcG9ydCB7IGNyZWF0ZVJlYWRTdHJlYW0gfSBmcm9tICdub2RlOmZzJ1xuaW1wb3J0IHsgcmVhZGRpciwgc3RhdCB9IGZyb20gJ25vZGU6ZnMvcHJvbWlzZXMnXG5pbXBvcnQgeyBJbmNvbWluZ01lc3NhZ2UsIFNlcnZlclJlc3BvbnNlIH0gZnJvbSAnbm9kZTpodHRwJ1xuaW1wb3J0IHBhdGggZnJvbSAnbm9kZTpwYXRoJ1xuaW1wb3J0IHsgcGlwZWxpbmUgfSBmcm9tICdub2RlOnN0cmVhbS9wcm9taXNlcydcbmltcG9ydCB1cmwgZnJvbSAnbm9kZTp1cmwnXG5pbXBvcnQgeyBwYXJzZSB9IGZyb20gJ25vZGU6cXVlcnlzdHJpbmcnXG5pbXBvcnQgeyBjb2xvciB9IGZyb20gJ3JvYm8uanMnXG5pbXBvcnQgdHlwZSB7IFJvdXRlciB9IGZyb20gJy4vcm91dGVyLmpzJ1xuaW1wb3J0IHR5cGUgeyBIdHRwTWV0aG9kLCBSb2JvUmVwbHksIFJvYm9SZXF1ZXN0IH0gZnJvbSAnLi90eXBlcy5qcydcbmltcG9ydCB0eXBlIHsgVXJsV2l0aFBhcnNlZFF1ZXJ5IH0gZnJvbSAnbm9kZTp1cmwnXG5pbXBvcnQgdHlwZSB7IFZpdGVEZXZTZXJ2ZXIgfSBmcm9tICd2aXRlJ1xuXG5jb25zdCBNQVhfQk9EWV9TSVpFID0gNSAqIDEwMjQgKiAxMDI0IC8vIDVNQlxuY29uc3QgQm9keU1ldGhvZHMgPSBbJ1BBVENIJywgJ1BPU1QnLCAnUFVUJ11cbmNvbnN0IFB1YmxpY1BhdGggPSBwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgJ3B1YmxpYycpXG5jb25zdCBQdWJsaWNCdWlsZFBhdGggPSBwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgJy5yb2JvJywgJ3B1YmxpYycpXG5cbmV4cG9ydCB0eXBlIFNlcnZlckhhbmRsZXIgPSAocmVxOiBJbmNvbWluZ01lc3NhZ2UsIHJlczogU2VydmVyUmVzcG9uc2U8SW5jb21pbmdNZXNzYWdlPikgPT4gUHJvbWlzZTx2b2lkPiB8IHZvaWRcblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVNlcnZlckhhbmRsZXIocm91dGVyOiBSb3V0ZXIsIHZpdGU/OiBWaXRlRGV2U2VydmVyKTogU2VydmVySGFuZGxlciB7XG5cdGNvbnN0IHsgcGFyc2VCb2R5ID0gdHJ1ZSB9ID0gcGx1Z2luT3B0aW9uc1xuXG5cdHJldHVybiBhc3luYyAocmVxOiBJbmNvbWluZ01lc3NhZ2UsIHJlczogU2VydmVyUmVzcG9uc2U8SW5jb21pbmdNZXNzYWdlPikgPT4ge1xuXHRcdGNvbnN0IHBhcnNlZFVybCA9IHVybC5wYXJzZShyZXEudXJsLCB0cnVlKVxuXG5cdFx0aWYgKHBsdWdpbk9wdGlvbnMuY29ycykge1xuXHRcdFx0Ly8gQ09SUyBIZWFkZXJzICh0byBhbGxvdyBhbnkgb3JpZ2luLCBhbnkgbWV0aG9kLCBhbmQgYW55IGhlYWRlcilcblx0XHRcdHJlcy5zZXRIZWFkZXIoJ0FjY2Vzcy1Db250cm9sLUFsbG93LU9yaWdpbicsICcqJylcblx0XHRcdHJlcy5zZXRIZWFkZXIoJ0FjY2Vzcy1Db250cm9sLUFsbG93LU1ldGhvZHMnLCAnKicpXG5cdFx0XHRyZXMuc2V0SGVhZGVyKCdBY2Nlc3MtQ29udHJvbC1BbGxvdy1IZWFkZXJzJywgJyonKVxuXG5cdFx0XHQvLyBQcmVmbGlnaHQgcmVxdWVzdC4gUmVwbHkgc3VjY2Vzc2Z1bGx5OlxuXHRcdFx0aWYgKHJlcS5tZXRob2QgPT09ICdPUFRJT05TJykge1xuXHRcdFx0XHRyZXMud3JpdGVIZWFkKDIwMClcblx0XHRcdFx0cmVzLmVuZCgpXG5cdFx0XHRcdHJldHVyblxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdC8vIFBhcnNlIHJlcXVlc3QgYm9keSBpZiBhcHBsaWNhYmxlXG5cdFx0bGV0IGJvZHk6IFJlY29yZDxzdHJpbmcsIHVua25vd24+XG5cblx0XHRpZiAocGFyc2VCb2R5ICYmIEJvZHlNZXRob2RzLmluY2x1ZGVzKHJlcS5tZXRob2QpKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRib2R5ID0gYXdhaXQgZ2V0UmVxdWVzdEJvZHkocmVxKVxuXHRcdFx0fSBjYXRjaCAoZXJyKSB7XG5cdFx0XHRcdGxvZ2dlci5lcnJvcihgRXJyb3IgaW4gcGFyc2luZyByZXF1ZXN0IGJvZHk6ICR7ZXJyfWApXG5cdFx0XHRcdHJlcy5zdGF0dXNDb2RlID0gNDAwXG5cdFx0XHRcdHJlcy5lbmQoJ0ludmFsaWQgcmVxdWVzdCBib2R5LicpXG5cdFx0XHRcdHJldHVyblxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdC8vIFByZXBhcmUgcmVxdWVzdCBhbmQgcmVwbHkgd3JhcHBlcnMgZm9yIGVhc2llciB1c2FnZVxuXHRcdGNvbnN0IHJlcXVlc3RXcmFwcGVyOiBSb2JvUmVxdWVzdCA9IHtcblx0XHRcdHJlcSxcblx0XHRcdGJvZHk6IGJvZHksXG5cdFx0XHRtZXRob2Q6IHJlcS5tZXRob2QgYXMgSHR0cE1ldGhvZCxcblx0XHRcdHF1ZXJ5OiB7fSxcblx0XHRcdHBhcmFtczoge30gLy8gdG8gYmUgZmlsbGVkIGJ5IHRoZSByb3V0ZSBoYW5kbGVyXG5cdFx0fVxuXG5cdFx0Ly8gUGFyc2UgcXVlcnkgc3RyaW5nIGlmIGFwcGxpY2FibGVcblx0XHRjb25zdCBxdWVyeUluZGV4ID0gcmVxLnVybD8uaW5kZXhPZignPycpID8/IC0xXG5cdFx0aWYgKHF1ZXJ5SW5kZXggIT09IC0xKSB7XG5cdFx0XHRyZXF1ZXN0V3JhcHBlci5xdWVyeSA9IHBhcnNlKHJlcS51cmwuc3Vic3RyaW5nKHF1ZXJ5SW5kZXggKyAxKSlcblx0XHR9XG5cblx0XHRjb25zdCByZXBseVdyYXBwZXI6IFJvYm9SZXBseSA9IHtcblx0XHRcdHJlcyxcblx0XHRcdGhhc1NlbnQ6IGZhbHNlLFxuXHRcdFx0Y29kZTogZnVuY3Rpb24gKHN0YXR1c0NvZGU6IG51bWJlcikge1xuXHRcdFx0XHR0aGlzLnJlcy5zdGF0dXNDb2RlID0gc3RhdHVzQ29kZVxuXHRcdFx0XHRyZXR1cm4gdGhpc1xuXHRcdFx0fSxcblx0XHRcdGpzb246IGZ1bmN0aW9uIChkYXRhOiB1bmtub3duKSB7XG5cdFx0XHRcdHRoaXMucmVzLnNldEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKVxuXHRcdFx0XHR0aGlzLnJlcy5lbmQoSlNPTi5zdHJpbmdpZnkoZGF0YSkpXG5cdFx0XHRcdHRoaXMuaGFzU2VudCA9IHRydWVcblx0XHRcdFx0cmV0dXJuIHRoaXNcblx0XHRcdH0sXG5cdFx0XHRzZW5kOiBmdW5jdGlvbiAoZGF0YTogc3RyaW5nKSB7XG5cdFx0XHRcdHRoaXMucmVzLmVuZChkYXRhKVxuXHRcdFx0XHR0aGlzLmhhc1NlbnQgPSB0cnVlXG5cdFx0XHRcdHJldHVybiB0aGlzXG5cdFx0XHR9LFxuXHRcdFx0aGVhZGVyOiBmdW5jdGlvbiAobmFtZTogc3RyaW5nLCB2YWx1ZTogc3RyaW5nKSB7XG5cdFx0XHRcdHRoaXMucmVzLnNldEhlYWRlcihuYW1lLCB2YWx1ZSlcblx0XHRcdFx0cmV0dXJuIHRoaXNcblx0XHRcdH1cblx0XHR9XG5cblx0XHQvLyBGaW5kIG1hdGNoaW5nIHJvdXRlIGFuZCBleGVjdXRlIGhhbmRsZXJcblx0XHRsb2dnZXIuZGVidWcoY29sb3IuYm9sZChyZXEubWV0aG9kKSwgcmVxLnVybClcblx0XHRjb25zdCByb3V0ZSA9IHJvdXRlci5maW5kKHBhcnNlZFVybC5wYXRobmFtZSlcblx0XHRyZXF1ZXN0V3JhcHBlci5wYXJhbXMgPSByb3V0ZT8ucGFyYW1zID8/IHt9XG5cblx0XHQvLyBJZiBWaXRlIGlzIGF2YWlsYWJsZSwgZm9yd2FyZCB0aGUgcmVxdWVzdCB0byBWaXRlXG5cdFx0aWYgKCFyb3V0ZT8uaGFuZGxlciAmJiB2aXRlKSB7XG5cdFx0XHRsb2dnZXIuZGVidWcoYEZvcndhcmRpbmcgdG8gVml0ZTpgLCByZXEudXJsKVxuXHRcdFx0dml0ZS5taWRkbGV3YXJlcyhyZXEsIHJlcylcblx0XHRcdHJldHVyblxuXHRcdH1cblxuXHRcdC8vIElmIHJvdXRlIG1pc3NpbmcsIGNoZWNrIGlmIHdlIGNhbiByZXR1cm4gc29tZXRoaW5nIGZyb20gdGhlIHB1YmxpYyBmb2xkZXJcblx0XHRpZiAoIXJvdXRlPy5oYW5kbGVyKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRjb25zdCBjYWxsYmFjayA9IGFzeW5jIChmaWxlUGF0aDogc3RyaW5nLCBtaW1lVHlwZTogc3RyaW5nKSA9PiB7XG5cdFx0XHRcdFx0cmVzLnNldEhlYWRlcignQ29udGVudC1UeXBlJywgbWltZVR5cGUpXG5cdFx0XHRcdFx0cmVzLnNldEhlYWRlcignWC1Db250ZW50LVR5cGUtT3B0aW9ucycsICdub3NuaWZmJylcblx0XHRcdFx0XHRyZXMud3JpdGVIZWFkKDIwMClcblx0XHRcdFx0XHRhd2FpdCBwaXBlbGluZShjcmVhdGVSZWFkU3RyZWFtKGZpbGVQYXRoKSwgcmVzKVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKGF3YWl0IGhhbmRsZVB1YmxpY0ZpbGUocGFyc2VkVXJsLCBjYWxsYmFjaykpIHtcblx0XHRcdFx0XHRyZXR1cm5cblx0XHRcdFx0fVxuXHRcdFx0fSBjYXRjaCAoZXJyb3IpIHtcblx0XHRcdFx0aWYgKGVycm9yIGluc3RhbmNlb2YgUm9ib1Jlc3BvbnNlKSB7XG5cdFx0XHRcdFx0aWYgKGVycm9yPy5zdGF0dXMgPj0gNDAwKSB7XG5cdFx0XHRcdFx0XHRsb2dnZXIuZXJyb3IoZXJyb3IpXG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0T2JqZWN0LmVudHJpZXMoZXJyb3IuaGVhZGVycyA/PyB7fSkuZm9yRWFjaCgoW2tleSwgdmFsdWVdKSA9PiB7XG5cdFx0XHRcdFx0XHRyZXBseVdyYXBwZXIuaGVhZGVyKGtleSwgdmFsdWUpXG5cdFx0XHRcdFx0fSlcblx0XHRcdFx0XHRyZXBseVdyYXBwZXIuY29kZShlcnJvci5zdGF0dXMgPz8gNTAwKS5qc29uKGVycm9yLmRhdGEgPz8gZXJyb3IubWVzc2FnZSlcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRsb2dnZXIuZXJyb3IoZXJyb3IpXG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXJvdXRlPy5oYW5kbGVyKSB7XG5cdFx0XHRyZXBseVdyYXBwZXIuY29kZSg0MDQpLmpzb24oJ0FQSSBSb3V0ZSBub3QgZm91bmQuJylcblx0XHRcdHJldHVyblxuXHRcdH1cblxuXHRcdHRyeSB7XG5cdFx0XHRjb25zdCByZXN1bHQgPSBhd2FpdCByb3V0ZS5oYW5kbGVyKHJlcXVlc3RXcmFwcGVyLCByZXBseVdyYXBwZXIpXG5cblx0XHRcdGlmICghcmVwbHlXcmFwcGVyLmhhc1NlbnQgJiYgcmVzdWx0KSB7XG5cdFx0XHRcdHJlcGx5V3JhcHBlci5jb2RlKDIwMCkuanNvbihyZXN1bHQpXG5cdFx0XHR9XG5cdFx0fSBjYXRjaCAoZXJyb3IpIHtcblx0XHRcdGlmIChlcnJvciBpbnN0YW5jZW9mIFJvYm9SZXNwb25zZSkge1xuXHRcdFx0XHRpZiAoZXJyb3I/LnN0YXR1cyA+PSA0MDApIHtcblx0XHRcdFx0XHRsb2dnZXIuZXJyb3IoZXJyb3IpXG5cdFx0XHRcdH1cblxuXHRcdFx0XHRPYmplY3QuZW50cmllcyhlcnJvci5oZWFkZXJzID8/IHt9KS5mb3JFYWNoKChba2V5LCB2YWx1ZV0pID0+IHtcblx0XHRcdFx0XHRyZXBseVdyYXBwZXIuaGVhZGVyKGtleSwgdmFsdWUpXG5cdFx0XHRcdH0pXG5cdFx0XHRcdHJlcGx5V3JhcHBlci5jb2RlKGVycm9yLnN0YXR1cyA/PyA1MDApLmpzb24oZXJyb3IuZGF0YSA/PyBlcnJvci5tZXNzYWdlKVxuXHRcdFx0fSBlbHNlIGlmIChlcnJvciBpbnN0YW5jZW9mIEVycm9yKSB7XG5cdFx0XHRcdGxvZ2dlci5lcnJvcihlcnJvcilcblx0XHRcdFx0cmVwbHlXcmFwcGVyLmNvZGUoNTAwKS5qc29uKGVycm9yLm1lc3NhZ2UgPz8gJ1NlcnZlciBlbmNvdW50ZXJlZCBhbiBlcnJvci4nKVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0bG9nZ2VyLmVycm9yKGVycm9yKVxuXHRcdFx0XHRyZXBseVdyYXBwZXIuY29kZSg1MDApLnNlbmQoJ1NlcnZlciBlbmNvdW50ZXJlZCBhbiBlcnJvci4nKVxuXHRcdFx0fVxuXHRcdH1cblx0fVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0UmVxdWVzdEJvZHkocmVxOiBJbmNvbWluZ01lc3NhZ2UpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIHVua25vd24+PiB7XG5cdHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG5cdFx0bGV0IGJvZHkgPSAnJ1xuXHRcdGxldCBzaXplID0gMFxuXHRcdHJlcS5vbignZGF0YScsIChjaHVuaykgPT4ge1xuXHRcdFx0c2l6ZSArPSBjaHVuay5sZW5ndGhcblx0XHRcdGlmIChzaXplID4gTUFYX0JPRFlfU0laRSkge1xuXHRcdFx0XHRyZWplY3QobmV3IEVycm9yKCdSZXF1ZXN0IGJvZHkgaXMgdG9vIGxhcmdlJykpXG5cdFx0XHRcdHJldHVyblxuXHRcdFx0fVxuXHRcdFx0Ym9keSArPSBjaHVua1xuXHRcdH0pXG5cdFx0cmVxLm9uKCdlbmQnLCAoKSA9PiB7XG5cdFx0XHQvLyBJdCdzIG9rYXkgdG8gaGF2ZSBlbXB0eSBib2R5IDwzXG5cdFx0XHRpZiAoIWJvZHkpIHtcblx0XHRcdFx0cmVzb2x2ZSh7fSlcblx0XHRcdFx0cmV0dXJuXG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdGNvbnN0IHBhcnNlZEJvZHkgPSBKU09OLnBhcnNlKGJvZHkpXG5cdFx0XHRcdHJlc29sdmUocGFyc2VkQm9keSlcblx0XHRcdH0gY2F0Y2ggKGVycikge1xuXHRcdFx0XHRyZWplY3QobmV3IEVycm9yKCdJbnZhbGlkIEpTT04gZGF0YScpKVxuXHRcdFx0fVxuXHRcdH0pXG5cdH0pXG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBoYW5kbGVQdWJsaWNGaWxlKFxuXHRwYXJzZWRVcmw6IFVybFdpdGhQYXJzZWRRdWVyeSxcblx0Y2FsbGJhY2s6IChmaWxlUGF0aDogc3RyaW5nLCBtaW1lVHlwZTogc3RyaW5nKSA9PiB2b2lkIHwgUHJvbWlzZTx2b2lkPlxuKSB7XG5cdC8vIERldGVybWluZSB3aGljaCBwdWJsaWMgZm9sZGVyIHRvIHVzZSAocHJvZHVjdGlvbiBvciBkZXZlbG9wbWVudClcblx0Y29uc3QgcHVibGljUGF0aCA9IHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAncHJvZHVjdGlvbicgPyBQdWJsaWNCdWlsZFBhdGggOiBQdWJsaWNQYXRoXG5cdGNvbnN0IGZpbGVQYXRoID0gZGVjb2RlVVJJKHBhdGguam9pbihwdWJsaWNQYXRoLCBwYXJzZWRVcmwucGF0aG5hbWUpKVxuXG5cdC8vIENoZWNrIGlmIHRoZSByZXF1ZXN0ZWQgcGF0aCBpcyB3aXRoaW4gdGhlIHB1YmxpYyBmb2xkZXIgdG8gZ3VhcmQgYWdhaW5zdCBkaXJlY3RvcnkgdHJhdmVyc2FsXG5cdGlmICghZmlsZVBhdGguc3RhcnRzV2l0aChwdWJsaWNQYXRoKSkge1xuXHRcdGxvZ2dlci53YXJuKGBSZXF1ZXN0ZWQgcGF0aCBpcyBvdXRzaWRlIHRoZSBwdWJsaWMgZm9sZGVyLiBEZW55aW5nIGFjY2Vzcy4uLmApXG5cdFx0dGhyb3cgbmV3IFJvYm9SZXNwb25zZSh7XG5cdFx0XHRzdGF0dXM6IDQwMyxcblx0XHRcdG1lc3NhZ2U6ICdBY2Nlc3MgRGVuaWVkJ1xuXHRcdH0pXG5cdH1cblxuXHQvLyBTZWUgaWYgdGhlIGZpbGUgZXhpc3RzXG5cdHRyeSB7XG5cdFx0Y29uc3Qgc3RhdHMgPSBhd2FpdCBzdGF0KGZpbGVQYXRoKVxuXG5cdFx0aWYgKHN0YXRzLmlzRmlsZSgpKSB7XG5cdFx0XHRsb2dnZXIuZGVidWcoYFNlcnZpbmcgcHVibGljIGZpbGU6ICR7ZmlsZVBhdGh9YClcblx0XHRcdGNvbnN0IGV4dCA9IHBhdGguZXh0bmFtZShmaWxlUGF0aCkuc2xpY2UoMSlcblx0XHRcdGNvbnN0IG1pbWVUeXBlID0gbWltZURiW2V4dF0gPz8gJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbSdcblx0XHRcdGF3YWl0IGNhbGxiYWNrKGZpbGVQYXRoLCBtaW1lVHlwZSlcblx0XHRcdHJldHVybiB0cnVlXG5cdFx0fSBlbHNlIGlmIChzdGF0cy5pc0RpcmVjdG9yeSgpKSB7XG5cdFx0XHQvLyBMb29rIGZvciBhbiBpbmRleCBmaWxlIGluIHRoZSBkaXJlY3Rvcnlcblx0XHRcdGNvbnN0IGZpbGVzID0gYXdhaXQgcmVhZGRpcihmaWxlUGF0aClcblx0XHRcdGNvbnN0IGluZGV4RXh0ZW5zaW9ucyA9IFsnaHRtbCcsICdodG0nLCAncGhwJywgJ2pzJywgJ2pzb24nXVxuXHRcdFx0Y29uc3QgaW5kZXhGaWxlID0gZmlsZXMuZmluZCgoZmlsZSkgPT4ge1xuXHRcdFx0XHRjb25zdCBleHRlbnNpb24gPSBwYXRoLmV4dG5hbWUoZmlsZSkuc2xpY2UoMSlcblx0XHRcdFx0cmV0dXJuIGluZGV4RXh0ZW5zaW9ucy5pbmNsdWRlcyhleHRlbnNpb24pICYmIGZpbGUuc3RhcnRzV2l0aCgnaW5kZXguJylcblx0XHRcdH0pXG5cblx0XHRcdGlmIChpbmRleEZpbGUpIHtcblx0XHRcdFx0Y29uc3QgaW5kZXhGaWxlUGF0aCA9IHBhdGguam9pbihmaWxlUGF0aCwgaW5kZXhGaWxlKVxuXHRcdFx0XHRjb25zdCBleHQgPSBwYXRoLmV4dG5hbWUoaW5kZXhGaWxlUGF0aCkuc2xpY2UoMSlcblx0XHRcdFx0Y29uc3QgbWltZVR5cGUgPSBtaW1lRGJbZXh0XSA/PyAnYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtJ1xuXHRcdFx0XHRsb2dnZXIuZGVidWcoJ1NlcnZpbmcgcHVibGljIGluZGV4IGZpbGU6JywgaW5kZXhGaWxlUGF0aClcblx0XHRcdFx0YXdhaXQgY2FsbGJhY2soaW5kZXhGaWxlUGF0aCwgbWltZVR5cGUpXG5cdFx0XHRcdHJldHVybiB0cnVlXG5cdFx0XHR9XG5cdFx0fVxuXHR9IGNhdGNoIChlcnJvcikge1xuXHRcdC8vIElnbm9yZSBFTk9FTlQgZXJyb3JzIChmaWxlIG5vdCBmb3VuZClcblx0XHRpZiAoZXJyb3IuY29kZSAhPT0gJ0VOT0VOVCcpIHtcblx0XHRcdHRocm93IGVycm9yXG5cdFx0fVxuXHR9XG5cblx0cmV0dXJuIGZhbHNlXG59XG4iXSwibmFtZXMiOlsiUm9ib1Jlc3BvbnNlIiwibG9nZ2VyIiwicGx1Z2luT3B0aW9ucyIsIm1pbWVEYiIsImNyZWF0ZVJlYWRTdHJlYW0iLCJyZWFkZGlyIiwic3RhdCIsInBhdGgiLCJwaXBlbGluZSIsInVybCIsInBhcnNlIiwiY29sb3IiLCJNQVhfQk9EWV9TSVpFIiwiQm9keU1ldGhvZHMiLCJQdWJsaWNQYXRoIiwiam9pbiIsInByb2Nlc3MiLCJjd2QiLCJQdWJsaWNCdWlsZFBhdGgiLCJjcmVhdGVTZXJ2ZXJIYW5kbGVyIiwicm91dGVyIiwidml0ZSIsInBhcnNlQm9keSIsInJlcSIsInJlcyIsInBhcnNlZFVybCIsImNvcnMiLCJzZXRIZWFkZXIiLCJtZXRob2QiLCJ3cml0ZUhlYWQiLCJlbmQiLCJib2R5IiwiaW5jbHVkZXMiLCJnZXRSZXF1ZXN0Qm9keSIsImVyciIsImVycm9yIiwic3RhdHVzQ29kZSIsInJlcXVlc3RXcmFwcGVyIiwicXVlcnkiLCJwYXJhbXMiLCJxdWVyeUluZGV4IiwiaW5kZXhPZiIsInN1YnN0cmluZyIsInJlcGx5V3JhcHBlciIsImhhc1NlbnQiLCJjb2RlIiwianNvbiIsImRhdGEiLCJKU09OIiwic3RyaW5naWZ5Iiwic2VuZCIsImhlYWRlciIsIm5hbWUiLCJ2YWx1ZSIsImRlYnVnIiwiYm9sZCIsInJvdXRlIiwiZmluZCIsInBhdGhuYW1lIiwiaGFuZGxlciIsIm1pZGRsZXdhcmVzIiwiY2FsbGJhY2siLCJmaWxlUGF0aCIsIm1pbWVUeXBlIiwiaGFuZGxlUHVibGljRmlsZSIsInN0YXR1cyIsIk9iamVjdCIsImVudHJpZXMiLCJoZWFkZXJzIiwiZm9yRWFjaCIsImtleSIsIm1lc3NhZ2UiLCJyZXN1bHQiLCJFcnJvciIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0Iiwic2l6ZSIsIm9uIiwiY2h1bmsiLCJsZW5ndGgiLCJwYXJzZWRCb2R5IiwicHVibGljUGF0aCIsImVudiIsIk5PREVfRU5WIiwiZGVjb2RlVVJJIiwic3RhcnRzV2l0aCIsIndhcm4iLCJzdGF0cyIsImlzRmlsZSIsImV4dCIsImV4dG5hbWUiLCJzbGljZSIsImlzRGlyZWN0b3J5IiwiZmlsZXMiLCJpbmRleEV4dGVuc2lvbnMiLCJpbmRleEZpbGUiLCJmaWxlIiwiZXh0ZW5zaW9uIiwiaW5kZXhGaWxlUGF0aCJdLCJtYXBwaW5ncyI6IkFBQUEsU0FBU0EsWUFBWSxRQUFRLHFCQUFvQjtBQUNqRCxTQUFTQyxNQUFNLFFBQVEsY0FBYTtBQUNwQyxTQUFTQyxhQUFhLFFBQVEsc0JBQXFCO0FBQ25ELFNBQVNDLE1BQU0sUUFBUSxZQUFXO0FBQ2xDLFNBQVNDLGdCQUFnQixRQUFRLFVBQVM7QUFDMUMsU0FBU0MsT0FBTyxFQUFFQyxJQUFJLFFBQVEsbUJBQWtCO0FBRWhELE9BQU9DLFVBQVUsWUFBVztBQUM1QixTQUFTQyxRQUFRLFFBQVEsdUJBQXNCO0FBQy9DLE9BQU9DLFNBQVMsV0FBVTtBQUMxQixTQUFTQyxLQUFLLFFBQVEsbUJBQWtCO0FBQ3hDLFNBQVNDLEtBQUssUUFBUSxVQUFTO0FBTS9CLE1BQU1DLGdCQUFnQixJQUFJLE9BQU8sS0FBSyxNQUFNOztBQUM1QyxNQUFNQyxjQUFjO0lBQUM7SUFBUztJQUFRO0NBQU07QUFDNUMsTUFBTUMsYUFBYVAsS0FBS1EsSUFBSSxDQUFDQyxRQUFRQyxHQUFHLElBQUk7QUFDNUMsTUFBTUMsa0JBQWtCWCxLQUFL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