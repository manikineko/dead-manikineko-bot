import { handlePublicFile } from "../../../.robo/build/core/handler.js";
import { logger } from "../core/logger.js";
import { BaseEngine } from "./base.js";
import { RoboResponse } from "../../../.robo/build/core/robo-response.js";
import { createReadStream } from "node:fs";
import url from "node:url";
import { color, composeColors } from "robo.js";
export class FastifyEngine extends BaseEngine {
    async init(options) {
        const { fastify  } = await import("fastify");
        this._server = fastify();
        this._vite = options.vite;
        this._server.setErrorHandler((error, _request, reply)=>{
            logger.error(error);
            reply.status(500).send({
                ok: false
            });
        });
        this._server.setNotFoundHandler((request, reply)=>{
            logger.debug(color.bold(request.method), request.raw.url);
            if (this._vite) {
                logger.debug(`Forwarding to Vite:`, request.url);
                this._vite.middlewares(request.raw, reply.raw);
                return;
            }
            const run = async ()=>{
                try {
                    const callback = async (filePath, mimeType)=>{
                        await reply.header('Content-Type', mimeType).header('X-Content-Type-Options', 'nosniff').type(mimeType).send(createReadStream(filePath));
                    };
                    const parsedUrl = url.parse(request.url, true);
                    if (await handlePublicFile(parsedUrl, callback)) {
                        return;
                    }
                } catch (error) {
                    if (error instanceof RoboResponse) {
                        if (error?.status >= 400) {
                            logger.error(error);
                        }
                        Object.entries(error.headers ?? {}).forEach(([key, value])=>{
                            reply.header(key, value);
                        });
                        reply.code(error.status ?? 500).send(error.data ?? error.message);
                        return;
                    } else {
                        logger.error(error);
                    }
                }
                reply.status(404).send({
                    message: `Route ${request.method}:${request.url} not found`,
                    error: 'Not Found',
                    statusCode: 404
                });
            };
            run();
        });
    }
    getHttpServer() {
        return this._server?.server;
    }
    isRunning() {
        return this._isRunning;
    }
    registerRoute(path, handler) {
        this._server.all(path, async (request, reply)=>{
            // Prepare request and reply wrappers for easier usage
            const requestWrapper = {
                req: request.raw,
                body: request.body,
                method: request.method,
                query: request.query,
                params: request.params
            };
            const replyWrapper = {
                res: reply.raw,
                hasSent: false,
                code: function(statusCode) {
                    reply.code(statusCode);
                    return this;
                },
                json: function(data) {
                    reply.header('Content-Type', 'application/json').send(JSON.stringify(data));
                    this.hasSent = true;
                    return this;
                },
                send: function(data) {
                    reply.send(data);
                    this.hasSent = true;
                    return this;
                },
                header: function(name, value) {
                    reply.header(name, value);
                    return this;
                }
            };
            try {
                logger.debug(color.bold(request.method), request.raw.url);
                const result = await handler(requestWrapper, replyWrapper);
                if (!replyWrapper.hasSent && result) {
                    replyWrapper.code(200).json(result);
                }
            } catch (error) {
                logger.error(error);
                replyWrapper.code(500).json({
                    ok: false,
                    errors: Array.isArray(error) ? error.map((e)=>e.message) : [
                        error.message
                    ]
                });
            }
        });
    }
    registerWebsocket() {
        logger.error(`Websockets are not supported in Fastify engine yet.`);
    }
    setupVite(vite) {
        this._vite = vite;
    }
    async start(options) {
        const { port  } = options;
        return new Promise((resolve)=>{
            const run = async ()=>{
                if (this._isRunning) {
                    logger.warn('Fastify server is already up and running. No action taken.');
                    resolve();
                    return;
                }
                // Start server
                this._isRunning = true;
                this._server.listen({
                    port
                }, ()=>{
                    logger.ready(`Fastify server is live at`, composeColors(color.bold, color.blue)(`http://localhost:${port}`));
                    resolve();
                });
            };
            run();
        });
    }
    async stop() {
        const serverPromise = new Promise((resolve)=>{
            if (!this._server) {
                logger.debug(`Fastify server isn't running. Nothing to stop here.`);
                resolve();
                return;
            }
            this._server.close().then(()=>{
                this._isRunning = false;
                logger.debug('Fastify server has been stopped successfully.');
                resolve();
            }).catch((err)=>{
                logger.error(`Error stopping the Fastify server: ${err}`);
            });
        });
        const vitePromise = this._vite?.close();
        await Promise.allSettled([
            serverPromise,
            vitePromise
        ]);
    }
    constructor(...args){
        super(...args);
        this._isRunning = false;
        this._server = null;
        this._vite = null;
    }
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL3J1bm5lci93b3JrL3JvYm8uanMvcm9iby5qcy9wYWNrYWdlcy9wbHVnaW4tYXBpL3NyYy9lbmdpbmVzL2Zhc3RpZnkudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgaGFuZGxlUHVibGljRmlsZSB9IGZyb20gJ34vY29yZS9oYW5kbGVyLmpzJ1xuaW1wb3J0IHsgbG9nZ2VyIH0gZnJvbSAnLi4vY29yZS9sb2dnZXIuanMnXG5pbXBvcnQgeyBCYXNlRW5naW5lIH0gZnJvbSAnLi9iYXNlLmpzJ1xuaW1wb3J0IHsgUm9ib1Jlc3BvbnNlIH0gZnJvbSAnfi9jb3JlL3JvYm8tcmVzcG9uc2UuanMnXG5pbXBvcnQgeyBjcmVhdGVSZWFkU3RyZWFtIH0gZnJvbSAnbm9kZTpmcydcbmltcG9ydCB1cmwgZnJvbSAnbm9kZTp1cmwnXG5pbXBvcnQgeyBjb2xvciwgY29tcG9zZUNvbG9ycyB9IGZyb20gJ3JvYm8uanMnXG5pbXBvcnQgdHlwZSB7IEh0dHBNZXRob2QsIFJvYm9SZXBseSwgUm9ib1JlcXVlc3QsIFJvdXRlSGFuZGxlciB9IGZyb20gJy4uL2NvcmUvdHlwZXMuanMnXG5pbXBvcnQgdHlwZSB7IEluaXRPcHRpb25zLCBTdGFydE9wdGlvbnMgfSBmcm9tICcuL2Jhc2UuanMnXG5pbXBvcnQgdHlwZSB7IEZhc3RpZnlJbnN0YW5jZSB9IGZyb20gJ2Zhc3RpZnknXG5pbXBvcnQgdHlwZSB7IFZpdGVEZXZTZXJ2ZXIgfSBmcm9tICd2aXRlJ1xuXG5leHBvcnQgY2xhc3MgRmFzdGlmeUVuZ2luZSBleHRlbmRzIEJhc2VFbmdpbmUge1xuXHRwcml2YXRlIF9pc1J1bm5pbmcgPSBmYWxzZVxuXHRwcml2YXRlIF9zZXJ2ZXI6IEZhc3RpZnlJbnN0YW5jZSB8IG51bGwgPSBudWxsXG5cdHByaXZhdGUgX3ZpdGU6IFZpdGVEZXZTZXJ2ZXIgfCBudWxsID0gbnVsbFxuXG5cdHB1YmxpYyBhc3luYyBpbml0KG9wdGlvbnM6IEluaXRPcHRpb25zKTogUHJvbWlzZTx2b2lkPiB7XG5cdFx0Y29uc3QgeyBmYXN0aWZ5IH0gPSBhd2FpdCBpbXBvcnQoJ2Zhc3RpZnknKVxuXHRcdHRoaXMuX3NlcnZlciA9IGZhc3RpZnkoKVxuXHRcdHRoaXMuX3ZpdGUgPSBvcHRpb25zLnZpdGVcblxuXHRcdHRoaXMuX3NlcnZlci5zZXRFcnJvckhhbmRsZXIoKGVycm9yLCBfcmVxdWVzdCwgcmVwbHkpID0+IHtcblx0XHRcdGxvZ2dlci5lcnJvcihlcnJvcilcblx0XHRcdHJlcGx5LnN0YXR1cyg1MDApLnNlbmQoeyBvazogZmFsc2UgfSlcblx0XHR9KVxuXG5cdFx0dGhpcy5fc2VydmVyLnNldE5vdEZvdW5kSGFuZGxlcigocmVxdWVzdCwgcmVwbHkpID0+IHtcblx0XHRcdGxvZ2dlci5kZWJ1Zyhjb2xvci5ib2xkKHJlcXVlc3QubWV0aG9kKSwgcmVxdWVzdC5yYXcudXJsKVxuXG5cdFx0XHRpZiAodGhpcy5fdml0ZSkge1xuXHRcdFx0XHRsb2dnZXIuZGVidWcoYEZvcndhcmRpbmcgdG8gVml0ZTpgLCByZXF1ZXN0LnVybClcblx0XHRcdFx0dGhpcy5fdml0ZS5taWRkbGV3YXJlcyhyZXF1ZXN0LnJhdywgcmVwbHkucmF3KVxuXHRcdFx0XHRyZXR1cm5cblx0XHRcdH1cblxuXHRcdFx0Y29uc3QgcnVuID0gYXN5bmMgKCkgPT4ge1xuXHRcdFx0XHR0cnkge1xuXHRcdFx0XHRcdGNvbnN0IGNhbGxiYWNrID0gYXN5bmMgKGZpbGVQYXRoOiBzdHJpbmcsIG1pbWVUeXBlOiBzdHJpbmcpID0+IHtcblx0XHRcdFx0XHRcdGF3YWl0IHJlcGx5XG5cdFx0XHRcdFx0XHRcdC5oZWFkZXIoJ0NvbnRlbnQtVHlwZScsIG1pbWVUeXBlKVxuXHRcdFx0XHRcdFx0XHQuaGVhZGVyKCdYLUNvbnRlbnQtVHlwZS1PcHRpb25zJywgJ25vc25pZmYnKVxuXHRcdFx0XHRcdFx0XHQudHlwZShtaW1lVHlwZSlcblx0XHRcdFx0XHRcdFx0LnNlbmQoY3JlYXRlUmVhZFN0cmVhbShmaWxlUGF0aCkpXG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0Y29uc3QgcGFyc2VkVXJsID0gdXJsLnBhcnNlKHJlcXVlc3QudXJsLCB0cnVlKVxuXHRcdFx0XHRcdGlmIChhd2FpdCBoYW5kbGVQdWJsaWNGaWxlKHBhcnNlZFVybCwgY2FsbGJhY2spKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm5cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0XHRcdFx0aWYgKGVycm9yIGluc3RhbmNlb2YgUm9ib1Jlc3BvbnNlKSB7XG5cdFx0XHRcdFx0XHRpZiAoZXJyb3I/LnN0YXR1cyA+PSA0MDApIHtcblx0XHRcdFx0XHRcdFx0bG9nZ2VyLmVycm9yKGVycm9yKVxuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRPYmplY3QuZW50cmllcyhlcnJvci5oZWFkZXJzID8/IHt9KS5mb3JFYWNoKChba2V5LCB2YWx1ZV0pID0+IHtcblx0XHRcdFx0XHRcdFx0cmVwbHkuaGVhZGVyKGtleSwgdmFsdWUpXG5cdFx0XHRcdFx0XHR9KVxuXHRcdFx0XHRcdFx0cmVwbHkuY29kZShlcnJvci5zdGF0dXMgPz8gNTAwKS5zZW5kKGVycm9yLmRhdGEgPz8gZXJyb3IubWVzc2FnZSlcblx0XHRcdFx0XHRcdHJldHVyblxuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRsb2dnZXIuZXJyb3IoZXJyb3IpXG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmVwbHlcblx0XHRcdFx0XHQuc3RhdHVzKDQwNClcblx0XHRcdFx0XHQuc2VuZCh7IG1lc3NhZ2U6IGBSb3V0ZSAke3JlcXVlc3QubWV0aG9kfToke3JlcXVlc3QudXJsfSBub3QgZm91bmRgLCBlcnJvcjogJ05vdCBGb3VuZCcsIHN0YXR1c0NvZGU6IDQwNCB9KVxuXHRcdFx0fVxuXHRcdFx0cnVuKClcblx0XHR9KVxuXHR9XG5cblx0cHVibGljIGdldEh0dHBTZXJ2ZXIoKSB7XG5cdFx0cmV0dXJuIHRoaXMuX3NlcnZlcj8uc2VydmVyXG5cdH1cblxuXHRwdWJsaWMgaXNSdW5uaW5nKCk6IGJvb2xlYW4ge1xuXHRcdHJldHVybiB0aGlzLl9pc1J1bm5pbmdcblx0fVxuXG5cdHB1YmxpYyByZWdpc3RlclJvdXRlKHBhdGg6IHN0cmluZywgaGFuZGxlcjogUm91dGVIYW5kbGVyKTogdm9pZCB7XG5cdFx0dGhpcy5fc2VydmVyLmFsbChwYXRoLCBhc3luYyAocmVxdWVzdCwgcmVwbHkpID0+IHtcblx0XHRcdC8vIFByZXBhcmUgcmVxdWVzdCBhbmQgcmVwbHkgd3JhcHBlcnMgZm9yIGVhc2llciB1c2FnZVxuXHRcdFx0Y29uc3QgcmVxdWVzdFdyYXBwZXI6IFJvYm9SZXF1ZXN0ID0ge1xuXHRcdFx0XHRyZXE6IHJlcXVlc3QucmF3LFxuXHRcdFx0XHRib2R5OiByZXF1ZXN0LmJvZHkgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4sXG5cdFx0XHRcdG1ldGhvZDogcmVxdWVzdC5tZXRob2QgYXMgSHR0cE1ldGhvZCxcblx0XHRcdFx0cXVlcnk6IHJlcXVlc3QucXVlcnkgYXMgUmVjb3JkPHN0cmluZywgc3RyaW5nPixcblx0XHRcdFx0cGFyYW1zOiByZXF1ZXN0LnBhcmFtcyBhcyBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+XG5cdFx0XHR9XG5cblx0XHRcdGNvbnN0IHJlcGx5V3JhcHBlcjogUm9ib1JlcGx5ID0ge1xuXHRcdFx0XHRyZXM6IHJlcGx5LnJhdyxcblx0XHRcdFx0aGFzU2VudDogZmFsc2UsXG5cdFx0XHRcdGNvZGU6IGZ1bmN0aW9uIChzdGF0dXNDb2RlOiBudW1iZXIpIHtcblx0XHRcdFx0XHRyZXBseS5jb2RlKHN0YXR1c0NvZGUpXG5cdFx0XHRcdFx0cmV0dXJuIHRoaXNcblx0XHRcdFx0fSxcblx0XHRcdFx0anNvbjogZnVuY3Rpb24gKGRhdGE6IHVua25vd24pIHtcblx0XHRcdFx0XHRyZXBseS5oZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJykuc2VuZChKU09OLnN0cmluZ2lmeShkYXRhKSlcblx0XHRcdFx0XHR0aGlzLmhhc1NlbnQgPSB0cnVlXG5cdFx0XHRcdFx0cmV0dXJuIHRoaXNcblx0XHRcdFx0fSxcblx0XHRcdFx0c2VuZDogZnVuY3Rpb24gKGRhdGE6IHN0cmluZykge1xuXHRcdFx0XHRcdHJlcGx5LnNlbmQoZGF0YSlcblx0XHRcdFx0XHR0aGlzLmhhc1NlbnQgPSB0cnVlXG5cdFx0XHRcdFx0cmV0dXJuIHRoaXNcblx0XHRcdFx0fSxcblx0XHRcdFx0aGVhZGVyOiBmdW5jdGlvbiAobmFtZTogc3RyaW5nLCB2YWx1ZTogc3RyaW5nKSB7XG5cdFx0XHRcdFx0cmVwbHkuaGVhZGVyKG5hbWUsIHZhbHVlKVxuXHRcdFx0XHRcdHJldHVybiB0aGlzXG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0bG9nZ2VyLmRlYnVnKGNvbG9yLmJvbGQocmVxdWVzdC5tZXRob2QpLCByZXF1ZXN0LnJhdy51cmwpXG5cdFx0XHRcdGNvbnN0IHJlc3VsdCA9IGF3YWl0IGhhbmRsZXIocmVxdWVzdFdyYXBwZXIsIHJlcGx5V3JhcHBlcilcblxuXHRcdFx0XHRpZiAoIXJlcGx5V3JhcHBlci5oYXNTZW50ICYmIHJlc3VsdCkge1xuXHRcdFx0XHRcdHJlcGx5V3JhcHBlci5jb2RlKDIwMCkuanNvbihyZXN1bHQpXG5cdFx0XHRcdH1cblx0XHRcdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0XHRcdGxvZ2dlci5lcnJvcihlcnJvcilcblx0XHRcdFx0cmVwbHlXcmFwcGVyLmNvZGUoNTAwKS5qc29uKHtcblx0XHRcdFx0XHRvazogZmFsc2UsXG5cdFx0XHRcdFx0ZXJyb3JzOiBBcnJheS5pc0FycmF5KGVycm9yKSA/IGVycm9yLm1hcCgoZSkgPT4gZS5tZXNzYWdlKSA6IFtlcnJvci5tZXNzYWdlXVxuXHRcdFx0XHR9KVxuXHRcdFx0fVxuXHRcdH0pXG5cdH1cblxuXHRwdWJsaWMgcmVnaXN0ZXJXZWJzb2NrZXQoKTogdm9pZCB7XG5cdFx0bG9nZ2VyLmVycm9yKGBXZWJzb2NrZXRzIGFyZSBub3Qgc3VwcG9ydGVkIGluIEZhc3RpZnkgZW5naW5lIHlldC5gKVxuXHR9XG5cblx0cHVibGljIHNldHVwVml0ZSh2aXRlOiBWaXRlRGV2U2VydmVyKSB7XG5cdFx0dGhpcy5fdml0ZSA9IHZpdGVcblx0fVxuXG5cdHB1YmxpYyBhc3luYyBzdGFydChvcHRpb25zOiBTdGFydE9wdGlvbnMpOiBQcm9taXNlPHZvaWQ+IHtcblx0XHRjb25zdCB7IHBvcnQgfSA9IG9wdGlvbnNcblxuXHRcdHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xuXHRcdFx0Y29uc3QgcnVuID0gYXN5bmMgKCkgPT4ge1xuXHRcdFx0XHRpZiAodGhpcy5faXNSdW5uaW5nKSB7XG5cdFx0XHRcdFx0bG9nZ2VyLndhcm4oJ0Zhc3RpZnkgc2VydmVyIGlzIGFscmVhZHkgdXAgYW5kIHJ1bm5pbmcuIE5vIGFjdGlvbiB0YWtlbi4nKVxuXHRcdFx0XHRcdHJlc29sdmUoKVxuXHRcdFx0XHRcdHJldHVyblxuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly8gU3RhcnQgc2VydmVyXG5cdFx0XHRcdHRoaXMuX2lzUnVubmluZyA9IHRydWVcblx0XHRcdFx0dGhpcy5fc2VydmVyLmxpc3Rlbih7IHBvcnQgfSwgKCkgPT4ge1xuXHRcdFx0XHRcdGxvZ2dlci5yZWFkeShgRmFzdGlmeSBzZXJ2ZXIgaXMgbGl2ZSBhdGAsIGNvbXBvc2VDb2xvcnMoY29sb3IuYm9sZCwgY29sb3IuYmx1ZSkoYGh0dHA6Ly9sb2NhbGhvc3Q6JHtwb3J0fWApKVxuXHRcdFx0XHRcdHJlc29sdmUoKVxuXHRcdFx0XHR9KVxuXHRcdFx0fVxuXHRcdFx0cnVuKClcblx0XHR9KVxuXHR9XG5cblx0cHVibGljIGFzeW5jIHN0b3AoKTogUHJvbWlzZTx2b2lkPiB7XG5cdFx0Y29uc3Qgc2VydmVyUHJvbWlzZSA9IG5ldyBQcm9taXNlPHZvaWQ+KChyZXNvbHZlKSA9PiB7XG5cdFx0XHRpZiAoIXRoaXMuX3NlcnZlcikge1xuXHRcdFx0XHRsb2dnZXIuZGVidWcoYEZhc3RpZnkgc2VydmVyIGlzbid0IHJ1bm5pbmcuIE5vdGhpbmcgdG8gc3RvcCBoZXJlLmApXG5cdFx0XHRcdHJlc29sdmUoKVxuXHRcdFx0XHRyZXR1cm5cblx0XHRcdH1cblxuXHRcdFx0dGhpcy5fc2VydmVyXG5cdFx0XHRcdC5jbG9zZSgpXG5cdFx0XHRcdC50aGVuKCgpID0+IHtcblx0XHRcdFx0XHR0aGlzLl9pc1J1bm5pbmcgPSBmYWxzZVxuXHRcdFx0XHRcdGxvZ2dlci5kZWJ1ZygnRmFzdGlmeSBzZXJ2ZXIgaGFzIGJlZW4gc3RvcHBlZCBzdWNjZXNzZnVsbHkuJylcblx0XHRcdFx0XHRyZXNvbHZlKClcblx0XHRcdFx0fSlcblx0XHRcdFx0LmNhdGNoKChlcnIpID0+IHtcblx0XHRcdFx0XHRsb2dnZXIuZXJyb3IoYEVycm9yIHN0b3BwaW5nIHRoZSBGYXN0aWZ5IHNlcnZlcjogJHtlcnJ9YClcblx0XHRcdFx0fSlcblx0XHR9KVxuXHRcdGNvbnN0IHZpdGVQcm9taXNlID0gdGhpcy5fdml0ZT8uY2xvc2UoKVxuXG5cdFx0YXdhaXQgUHJvbWlzZS5hbGxTZXR0bGVkKFtzZXJ2ZXJQcm9taXNlLCB2aXRlUHJvbWlzZV0pXG5cdH1cbn1cbiJdLCJuYW1lcyI6WyJoYW5kbGVQdWJsaWNGaWxlIiwibG9nZ2VyIiwiQmFzZUVuZ2luZSIsIlJvYm9SZXNwb25zZSIsImNyZWF0ZVJlYWRTdHJlYW0iLCJ1cmwiLCJjb2xvciIsImNvbXBvc2VDb2xvcnMiLCJGYXN0aWZ5RW5naW5lIiwiaW5pdCIsIm9wdGlvbnMiLCJmYXN0aWZ5IiwiX3NlcnZlciIsIl92aXRlIiwidml0ZSIsInNldEVycm9ySGFuZGxlciIsImVycm9yIiwiX3JlcXVlc3QiLCJyZXBseSIsInN0YXR1cyIsInNlbmQiLCJvayIsInNldE5vdEZvdW5kSGFuZGxlciIsInJlcXVlc3QiLCJkZWJ1ZyIsImJvbGQiLCJtZXRob2QiLCJyYXciLCJtaWRkbGV3YXJlcyIsInJ1biIsImNhbGxiYWNrIiwiZmlsZVBhdGgiLCJtaW1lVHlwZSIsImhlYWRlciIsInR5cGUiLCJwYXJzZWRVcmwiLCJwYXJzZSIsIk9iamVjdCIsImVudHJpZXMiLCJoZWFkZXJzIiwiZm9yRWFjaCIsImtleSIsInZhbHVlIiwiY29kZSIsImRhdGEiLCJtZXNzYWdlIiwic3RhdHVzQ29kZSIsImdldEh0dHBTZXJ2ZXIiLCJzZXJ2ZXIiLCJpc1J1bm5pbmciLCJfaXNSdW5uaW5nIiwicmVnaXN0ZXJSb3V0ZSIsInBhdGgiLCJoYW5kbGVyIiwiYWxsIiwicmVxdWVzdFdyYXBwZXIiLCJyZXEiLCJib2R5IiwicXVlcnkiLCJwYXJhbXMiLCJyZXBseVdyYXBwZXIiLCJyZXMiLCJoYXNTZW50IiwianNvbiIsIkpTT04iLCJzdHJpbmdpZnkiLCJuYW1lIiwicmVzdWx0IiwiZXJyb3JzIiwiQXJyYXkiLCJpc0FycmF5IiwibWFwIiwiZSIsInJlZ2lzdGVyV2Vic29ja2V0Iiwic2V0dXBWaXRlIiwic3RhcnQiLCJwb3J0IiwiUHJvbWlzZSIsInJlc29sdmUiLCJ3YXJuIiwibGlzdGVuIiwicmVhZHkiLCJibHVlIiwic3RvcCIsInNlcnZlclByb21pc2UiLCJjbG9zZSIsInRoZW4iLCJjYXRjaCIsImVyciIsInZpdGVQcm9taXNlIiwiYWxsU2V0dGxlZCJdLCJtYXBwaW5ncyI6IkFBQUEsU0FBU0EsZ0JBQWdCLFFBQVEsdUNBQW1CO0FBQ3BELFNBQVNDLE1BQU0sUUFBUSxvQkFBbUI7QUFDMUMsU0FBU0MsVUFBVSxRQUFRLFlBQVc7QUFDdEMsU0FBU0MsWUFBWSxRQUFRLDZDQUF5QjtBQUN0RCxTQUFTQyxnQkFBZ0IsUUFBUSxVQUFTO0FBQzFDLE9BQU9DLFNBQVMsV0FBVTtBQUMxQixTQUFTQyxLQUFLLEVBQUVDLGFBQWEsUUFBUSxVQUFTO0FBTTlDLE9BQU8sTUFBTUMsc0JBQXNCTjtJQUtsQyxNQUFhTyxLQUFLQyxPQUFvQixFQUFpQjtRQUN0RCxNQUFNLEVBQUVDLFFBQU8sRUFBRSxHQUFHLE1BQU0sTUFBTSxDQUFDO1FBQ2pDLElBQUksQ0FBQ0MsT0FB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